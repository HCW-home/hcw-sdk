{"version":3,"file":"hug-angular-lib.js","sources":["ng://hug-angular-lib/lib/hug-angular-lib.component.ts","ng://hug-angular-lib/lib/log.service.ts","ng://hug-angular-lib/lib/hug-angular-lib.module.ts","ng://hug-angular-lib/lib/stream.ts","ng://hug-angular-lib/lib/signaling.service.ts","ng://hug-angular-lib/lib/peer.ts","ng://hug-angular-lib/lib/remote-peers.service.ts","ng://hug-angular-lib/lib/room.service.ts","ng://hug-angular-lib/public-api.ts","ng://hug-angular-lib/hug-angular-lib.ts"],"sourcesContent":["import { Component, OnInit } from '@angular/core';\n\n@Component({\n  selector: 'lib-hug-angular-lib',\n  template: `\n    <p>\n      hug-fuck shit address\n    </p>\n  `,\n  styles: []\n})\nexport class HugAngularLibComponent implements OnInit {\n\n  constructor() { }\n\n  ngOnInit(): void {\n\n  }\n\n}\n","// import { Injectable } from '@angular/core';\nexport { NGXLogger as LogService } from 'ngx-logger';\n\n// @Injectable({\n//   providedIn: 'root'\n// })\n// export class LogService extends NGXLogger {\n\n//   constructor() {\n//     super()\n//   }\n// }\n","import { LogService } from './log.service';\nimport { NgModule } from '@angular/core';\nimport { HugAngularLibComponent } from './hug-angular-lib.component';\nimport { LoggerModule, NgxLoggerLevel } from 'ngx-logger';\n\nconsole.log('NGX logger')\n@NgModule({\n  declarations: [HugAngularLibComponent],\n  imports: [\n    LoggerModule.forRoot({ level: NgxLoggerLevel.DEBUG})\n  ],\n  providers:[LogService],\n  exports: [HugAngularLibComponent]\n})\nexport class HugAngularLibModule { }\n","import { Subject } from 'rxjs';\n\n\nimport * as mediasoup from 'mediasoup-client';\n\nimport { Peer } from './peer';\n\n\nexport class Stream {\n\n  public consumer?: mediasoup.types.Consumer;\n  public peer?: Peer;\n  public producer?\n  public streamId: string;\n\n  public onLayerChange: Subject<any> = new Subject()\n\n  public type;\n  public producerPaused: boolean\n\n  public kind;\n\n  mediaStream: MediaStream = new MediaStream();\n\n  setConsumer(consumer: mediasoup.types.Consumer) {\n    this.consumer = consumer;\n    this.streamId = consumer.id\n    this.kind = consumer.kind;\n    this.mediaStream.addTrack(consumer.track);\n  }\n\n  consumerLayerChanged() {\n    this.mediaStream = new MediaStream();\n    this.mediaStream.addTrack(this.consumer.track);\n    this.onLayerChange.next()\n  }\n\n\n  setProducer(producer) {\n    this.producer = producer\n    this.mediaStream.addTrack(producer.track);\n  }\n}\n","import { LogService } from './log.service';\nimport { Injectable } from '@angular/core';\n\n\nimport { io, Socket } from 'socket.io-client';\nimport { Subject } from 'rxjs';\n\n\nconst requestTimeout = 20000\n\n/**\n * Error produced when a socket request has a timeout.\n */\nexport class SocketTimeoutError extends Error\n{\n\tconstructor(message)\n\t{\n\t\tsuper(message);\n\n\t\tthis.name = 'SocketTimeoutError';\n\n    if (Error.hasOwnProperty('captureStackTrace')) // Just in V8.\n      // @ts-ignore\n\t\t\tError.captureStackTrace(this, SocketTimeoutError);\n\t\telse\n\t\t\tthis.stack = (new Error(message)).stack;\n\t}\n}\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class SignalingService  {\n\n  peerId: string;\n  roomId: string;\n  _signalingSocket: Socket;\n  _signalingBaseUrl = 'wss://localhost';\n  _signalingUrl: string;\n  _closed = false;\n\n  onDisconnected: Subject<any> = new Subject()\n  onReconnecting: Subject<any> = new Subject()\n  onReconnected: Subject<any> = new Subject()\n  onNewConsumer: Subject<any> = new Subject();\n  onNotification: Subject<any> = new Subject();\n  constructor(private logger: LogService ) {\n\n   }\n\n\n  init(roomId, peerId) {\n\n    this._signalingUrl =\n    `${this._signalingBaseUrl}/?roomId=${roomId}&peerId=${peerId}`;\n    this._signalingSocket = io(this._signalingUrl)\n    this.logger.debug(\"Initialize socket \", this._signalingUrl)\n\n\n\t\tthis._signalingSocket.on('connect', () =>\n\t\t{\n\t\t \tthis.logger.debug('signaling Peer \"connect\" event');\n    });\n\n    this._signalingSocket.on('disconnect', (reason) =>\n\t\t{\n\t\t\tthis.logger.warn('signaling Peer \"disconnect\" event [reason:\"%s\"]', reason);\n\n\t\t\tif (this._closed)\n\t\t\t\treturn;\n\n\t\t\tif (reason === 'io server disconnect')\n\t\t\t{\n        this.onDisconnected.next()\n\n\t\t\t\tthis.close();\n\t\t\t}\n\n      this.onReconnecting.next\n\n\t\t});\n\n    this._signalingSocket.on('reconnect_failed', () =>\n\t\t{\n\t\t\tthis.logger.warn('signaling Peer \"reconnect_failed\" event');\n\n      this.onDisconnected.next()\n\n\t\t\tthis.close();\n    });\n\n\n\t\tthis._signalingSocket.on('reconnect', (attemptNumber) =>\n\t\t{\n\t\t\tthis.logger.debug('signaling Peer \"reconnect\" event [attempts:\"%s\"]', attemptNumber);\n\n      this.onReconnected.next(attemptNumber)\n\n\n\t\t\t// store.dispatch(roomActions.setRoomState('connected'));\n\t\t});\n\n\n\n\t\tthis._signalingSocket.on('request', async (request, cb) =>\n\t\t{\n\t\t\tthis.logger.debug(\n\t\t\t\t'socket \"request\" event [method:\"%s\", data:\"%o\"]',\n\t\t\t\trequest.method, request.data);\n\n\n\t\t\tswitch (request.method)\n\t\t\t{\n\t\t\t\tcase 'newConsumer':\n\t\t\t\t{\n            this.onNewConsumer.next(request.data);\n            cb()\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tdefault:\n\t\t\t\t{\n\t\t\t\t\tthis.logger.error('unknown request.method \"%s\"', request.method);\n\n\t\t\t\t\tcb(500, `unknown request.method \"${request.method}\"`);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n    this._signalingSocket.on('notification', (notification) => {\n      this.logger.debug(\n        'socket \"notification\" event [method:\"%s\", data:\"%o\"]',\n        notification.method, notification.data);\n\n      this.onNotification.next(notification)\n\n    });\n\n\n\n  }\n  close() {\n    if (this._closed)\n      return;\n\n    this._closed = true;\n\n    this.logger.debug('close()');\n\n    this._signalingSocket.close();\n\n\n  }\n\ttimeoutCallback(callback)\n\t{\n\t\tlet called = false;\n\n\t\tconst interval = setTimeout(\n\t\t\t() =>\n\t\t\t{\n\t\t\t\tif (called)\n\t\t\t\t\treturn;\n\t\t\t\tcalled = true;\n\t\t\t\tcallback(new SocketTimeoutError('Request timed out'));\n\t\t\t},\n\t\t\trequestTimeout\n\t\t);\n\n\t\treturn (...args) =>\n\t\t{\n\t\t\tif (called)\n\t\t\t\treturn;\n\t\t\tcalled = true;\n\t\t\tclearTimeout(interval);\n\n\t\t\tcallback(...args);\n\t\t};\n\t}\n\n\t_sendRequest(method, data)\n\t{\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tif (!this._signalingSocket)\n\t\t\t{\n\t\t\t\treject('No socket connection');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis._signalingSocket.emit(\n\t\t\t\t\t'request',\n\t\t\t\t\t{ method, data },\n\t\t\t\t\tthis.timeoutCallback((err, response) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tif (err)\n\t\t\t\t\t\t\treject(err);\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tresolve(response);\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t}\n\t\t});\n  }\n\n\n\tpublic async sendRequest(method, data?):Promise<any>\n\t{\n\t\tthis.logger.debug('sendRequest() [method:\"%s\", data:\"%o\"]', method, data);\n\n\t\tconst requestRetries = 3\n\n\n\t\tfor (let tries = 0; tries < requestRetries; tries++)\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\treturn await this._sendRequest(method, data);\n\t\t\t}\n\t\t\tcatch (error)\n\t\t\t{\n\t\t\t\tif (\n\t\t\t\t\terror instanceof SocketTimeoutError &&\n\t\t\t\t\ttries < requestRetries\n\t\t\t\t)\n\t\t\t\t\tthis.logger.warn('sendRequest() | timeout, retrying [attempt:\"%s\"]', tries);\n\t\t\t\telse\n\t\t\t\t\tthrow error;\n\t\t\t}\n\t\t}\n\t}\n\n}\n","import { Stream } from './stream';\nexport class Peer {\n  id: string\n  streams: Stream[]=[]\n}\n","import { Stream } from './stream';\nimport { LogService } from './log.service';\nimport { Peer } from './peer';\nimport { Observable } from 'rxjs/internal/Observable';\nimport { Injectable } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\nimport * as mediasoup from 'mediasoup-client';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class RemotePeersService {\n\n\tpublic remotePeers: Observable<Peer[]>;\n\tprivate _remotePeers: BehaviorSubject<Peer[]> = new BehaviorSubject([]);\n\n  private peers: Peer[] = []\n  constructor(private logger: LogService) {\n    this.remotePeers = this._remotePeers.asObservable()\n   }\n\n\n  updatePeers() {\n    setTimeout(() => \tthis._remotePeers.next(this.peers)    ,0)\n  }\n\n  clearPeers(){\n    this._remotePeers = <BehaviorSubject<Peer[]>>new BehaviorSubject([]);\n    this.remotePeers = this._remotePeers.asObservable();\n    this.peers = []\n  }\n  newPeer(id): Peer {\n    this.logger.debug('New peer', id)\n    const peer = new Peer()\n    peer.id = id;\n    peer.streams = []\n    this.addPeer(peer)\n    this.updatePeers()\n    return peer\n  }\n  closePeer(id){\n\t\tthis.logger.debug(\n\t\t\t'room \"peerClosed\" event [peerId:%o]', id);\n\n    this.peers = this.peers.filter((peer) => peer.id !== id);\n    this.updatePeers()\n  }\n\n\n  addPeer(peer: Peer) {\n    this.peers.push(peer)\n  }\n\n  addPeers(peers){\n    this.logger.debug('Add peers ', peers)\n\t\tfor (const peer of peers)\n\t\t{\n\t\t\tif (!this.peers.find(p=>peer.id === p.id))\n\t\t\t{\n\t\t\t\tthis.logger.debug('adding peer [peerId: \"%s\"]', peer.id);\n        this.peers.push({ id: peer.id, streams:[] });\n\t\t\t}\n\t\t}\n\t\tthis.updatePeers();\n  }\n\n  newConsumer(consumer: mediasoup.types.Consumer, peerId: string, type, producerPaused) {\n\n    this.logger.debug('remote peers New consumer', consumer, peerId)\n    let peer = this.peers.find(peer => peer.id === peerId)\n\n    if (!peer) {\n      this.logger.warn('Couldn\\'t find peer', peerId, this.peers)\n      peer = this.newPeer(peerId)\n    }\n    const existingStream = peer.streams.find(stream => stream.consumer?.appData.source === consumer.appData.source)\n\n    if (existingStream) {\n      existingStream.setConsumer(consumer)\n    } else {\n      const stream = new Stream()\n      stream.peer = peer\n      stream.type = type;\n      stream.producerPaused = producerPaused;\n      stream.setConsumer(consumer)\n      this.logger.debug('New stream created ', stream)\n      peer.streams.push(stream)\n    }\n\n    this.updatePeers()\n\n  }\n\n  onConsumerLayerChanged(consumerId) {\n\n\n\n      const stream = this.getStreamByConsumerId( consumerId)\n      if (stream) {\n\n        stream.consumerLayerChanged()\n      }\n\n  }\n\n\n  getStreamByConsumerId(consumerId: string): Stream {\n    for (const peer of this.peers) {\n      const stream = peer.streams.find(s => s.consumer.id === consumerId)\n      if (stream) {\n        return stream\n      }\n    }\n    return null\n  }\n}\n","import { Stream } from './stream';\nimport { RemotePeersService } from './remote-peers.service';\nimport { LogService } from './log.service';\nimport { SignalingService } from './signaling.service';\n\nimport { Injectable } from '@angular/core';\n\nimport { switchMap } from 'rxjs/operators';\nimport bowser from 'bowser';\n\nimport * as mediasoupClient from 'mediasoup-client'\nimport { Subject } from 'rxjs';\n\n\nlet saveAs;\n\n\nconst lastN = 4\nconst mobileLastN = 1\nconst videoAspectRatio = 1.777\n\nconst simulcast = true;\nconst \tsimulcastEncodings   = [\n  { scaleResolutionDownBy: 4 },\n  { scaleResolutionDownBy: 2 },\n  { scaleResolutionDownBy: 1 }\n]\n\n\nconst VIDEO_CONSTRAINS =\n{\n\t'low' :\n\t{\n\t\twidth       : { ideal: 320 },\n\t\taspectRatio : videoAspectRatio\n\t},\n\t'medium' :\n\t{\n\t\twidth       : { ideal: 640 },\n\t\taspectRatio : videoAspectRatio\n\t},\n\t'high' :\n\t{\n\t\twidth       : { ideal: 1280 },\n\t\taspectRatio : videoAspectRatio\n\t},\n\t'veryhigh' :\n\t{\n\t\twidth       : { ideal: 1920 },\n\t\taspectRatio : videoAspectRatio\n\t},\n\t'ultra' :\n\t{\n\t\twidth       : { ideal: 3840 },\n\t\taspectRatio : videoAspectRatio\n\t}\n};\n\nconst PC_PROPRIETARY_CONSTRAINTS =\n{\n\toptional : [ { googDscp: true } ]\n};\n\nconst VIDEO_SIMULCAST_ENCODINGS =\n[\n\t{ scaleResolutionDownBy: 4, maxBitRate: 100000 },\n\t{ scaleResolutionDownBy: 1, maxBitRate: 1200000 }\n];\n\n// Used for VP9 webcam video.\nconst VIDEO_KSVC_ENCODINGS =\n[\n\t{ scalabilityMode: 'S3T3_KEY' }\n];\n\n// Used for VP9 desktop sharing.\nconst VIDEO_SVC_ENCODINGS =\n[\n\t{ scalabilityMode: 'S3T3', dtx: true }\n];\n\n\n@Injectable({\n  providedIn: 'root'\n})\nexport  class RoomService {\n\n\n\n  // Transport for sending.\n  _sendTransport = null;\n  // Transport for receiving.\n  _recvTransport = null;\n\n  _closed = false;\n\n  _produce = true;\n\n  _forceTcp = false;\n\n  _muted\n  _device\n  _peerId\n  _soundAlert\n  _roomId\n  _mediasoupDevice\n\n  _micProducer\n  _hark\n  _harkStream\n  _webcamProducer\n  _extraVideoProducers\n  _webcams\n  _audioDevices\n  _audioOutputDevices\n  _consumers\n  _useSimulcast\n  _turnServers\n\n  public onCamProducing: Subject<any> = new Subject();\n  constructor(\n    private signalingService: SignalingService,\n    private logger: LogService,\n  private remotePeersService: RemotePeersService) {\n\n\n  }\n\n  init({\n    peerId=null,\n\n    produce=true,\n    forceTcp=false,\n    muted=false\n  } = {}) {\n    if (!peerId)\n      throw new Error('Missing peerId');\n\n\n    // logger.debug(\n    //   'constructor() [peerId: \"%s\", device: \"%s\", produce: \"%s\", forceTcp: \"%s\", displayName \"\"]',\n    //   peerId, device.flag, produce, forceTcp);\n\n\n\n\n    // Whether we should produce.\n    this._produce = produce;\n\n    // Whether we force TCP\n    this._forceTcp = forceTcp;\n\n\n\n\n    // Whether simulcast should be used.\n    // this._useSimulcast = false;\n\n    // if ('simulcast' in window.config)\n    //   this._useSimulcast = window.config.simulcast;\n\n\n\n\n\n    this._muted = muted;\n\n    // This device\n    this._device = this.deviceInfo();\n\n    // My peer name.\n    this._peerId = peerId;\n\n\n\n    // Alert sound\n    // this._soundAlert = new Audio('/sounds/notify.mp3');\n\n\n\n\n    // The room ID\n    this._roomId = null;\n\n    // mediasoup-client Device instance.\n    // @type {mediasoupClient.Device}\n    this._mediasoupDevice = null;\n\n\n    // Transport for sending.\n    this._sendTransport = null;\n\n    // Transport for receiving.\n    this._recvTransport = null;\n\n    // Local mic mediasoup Producer.\n    this._micProducer = null;\n\n    // Local mic hark\n    this._hark = null;\n\n    // Local MediaStream for hark\n    this._harkStream = null;\n\n    // Local webcam mediasoup Producer.\n    this._webcamProducer = null;\n\n    // Extra videos being produced\n    this._extraVideoProducers = new Map();\n\n    // Map of webcam MediaDeviceInfos indexed by deviceId.\n    // @type {Map<String, MediaDeviceInfos>}\n    this._webcams = {};\n\n    this._audioDevices = {};\n\n    this._audioOutputDevices = {};\n\n    // mediasoup Consumers.\n    // @type {Map<String, mediasoupClient.Consumer>}\n    this._consumers = new Map();\n\n    this._useSimulcast = simulcast\n\n    // this._startKeyListener();\n\n    // this._startDevicesListener();\n\n  }\n  close() {\n    if (this._closed)\n      return;\n\n    this._closed = true;\n\n    this.logger.debug('close()');\n\n    this.signalingService.close();\n\n    // Close mediasoup Transports.\n    if (this._sendTransport)\n      this._sendTransport.close();\n\n    if (this._recvTransport)\n      this._recvTransport.close();\n\n\n  }\n\n  // _startKeyListener() {\n  //   // Add keydown event listener on document\n  //   document.addEventListener('keydown', (event) => {\n  //     if (event.repeat) return;\n  //     const key = String.fromCharCode(event.which);\n\n  //     const source = event.target;\n\n  //     const exclude = ['input', 'textarea'];\n\n  //     if (exclude.indexOf(source.tagName.toLowerCase()) === -1) {\n  //       logger.debug('keyDown() [key:\"%s\"]', key);\n\n  //       switch (key) {\n\n  //         /*\n  //         case String.fromCharCode(37):\n  //         {\n  //           const newPeerId = this._spotlights.getPrevAsSelected(\n  //             store.getState().room.selectedPeerId);\n\n  //           if (newPeerId) this.setSelectedPeer(newPeerId);\n  //           break;\n  //         }\n\n  //         case String.fromCharCode(39):\n  //         {\n  //           const newPeerId = this._spotlights.getNextAsSelected(\n  //             store.getState().room.selectedPeerId);\n\n  //           if (newPeerId) this.setSelectedPeer(newPeerId);\n  //           break;\n  //         }\n  //         */\n\n\n  //         case 'M': // Toggle microphone\n  //           {\n  //             if (this._micProducer) {\n  //               if (!this._micProducer.paused) {\n  //                 this.muteMic();\n\n  //                 store.dispatch(requestActions.notify(\n  //                   {\n  //                     text: intl.formatMessage({\n  //                       id: 'devices.microphoneMute',\n  //                       defaultMessage: 'Muted your microphone'\n  //                     })\n  //                   }));\n  //               }\n  //               else {\n  //                 this.unmuteMic();\n\n  //                 store.dispatch(requestActions.notify(\n  //                   {\n  //                     text: intl.formatMessage({\n  //                       id: 'devices.microphoneUnMute',\n  //                       defaultMessage: 'Unmuted your microphone'\n  //                     })\n  //                   }));\n  //               }\n  //             }\n  //             else {\n  //               this.updateMic({ start: true });\n\n  //               store.dispatch(requestActions.notify(\n  //                 {\n  //                   text: intl.formatMessage({\n  //                     id: 'devices.microphoneEnable',\n  //                     defaultMessage: 'Enabled your microphone'\n  //                   })\n  //                 }));\n  //             }\n\n  //             break;\n  //           }\n\n  //         case 'V': // Toggle video\n  //           {\n  //             if (this._webcamProducer)\n  //               this.disableWebcam();\n  //             else\n  //               this.updateWebcam({ start: true });\n\n  //             break;\n  //           }\n\n  //         case 'H': // Open help dialog\n  //           {\n  //             store.dispatch(roomActions.setHelpOpen(true));\n\n  //             break;\n  //           }\n\n  //         default:\n  //           {\n  //             break;\n  //           }\n  //       }\n  //     }\n  //   });\n\n\n  // }\n\n  _startDevicesListener() {\n    navigator.mediaDevices.addEventListener('devicechange', async () => {\n      this.logger.debug('_startDevicesListener() | navigator.mediaDevices.ondevicechange');\n\n      await this._updateAudioDevices();\n      await this._updateWebcams();\n      await this._updateAudioOutputDevices();\n\n      // store.dispatch(requestActions.notify(\n      //   {\n      //     text: intl.formatMessage({\n      //       id: 'devices.devicesChanged',\n      //       defaultMessage: 'Your devices changed, configure your devices in the settings dialog'\n      //     })\n      //   }));\n    });\n  }\n\n\n\n  async muteMic() {\n    this.logger.debug('muteMic()');\n\n    this._micProducer.pause();\n\n    try {\n      await this.signalingService.sendRequest(\n        'pauseProducer', { producerId: this._micProducer.id });\n\n      // store.dispatch(\n      //   producerActions.setProducerPaused(this._micProducer.id));\n\n      // store.dispatch(\n      //   settingsActions.setAudioMuted(true));\n\n    }\n    catch (error) {\n      this.logger.error('muteMic() [error:\"%o\"]', error);\n\n      // store.dispatch(requestActions.notify(\n      //   {\n      //     type: 'error',\n      //     text: intl.formatMessage({\n      //       id: 'devices.microphoneMuteError',\n      //       defaultMessage: 'Unable to mute your microphone'\n      //     })\n      //   }));\n    }\n  }\n\n  async unmuteMic() {\n    this.logger.debug('unmuteMic()');\n\n    if (!this._micProducer) {\n      this.updateMic({ start: true });\n    }\n    else {\n      this._micProducer.resume();\n\n      try {\n        await this.signalingService.sendRequest(\n          'resumeProducer', { producerId: this._micProducer.id });\n\n        // store.dispatch(\n        //   producerActions.setProducerResumed(this._micProducer.id));\n\n        // store.dispatch(\n        //   settingsActions.setAudioMuted(false));\n\n      }\n      catch (error) {\n        this.logger.error('unmuteMic() [error:\"%o\"]', error);\n\n        // store.dispatch(requestActions.notify(\n        //   {\n        //     type: 'error',\n        //     text: intl.formatMessage({\n        //       id: 'devices.microphoneUnMuteError',\n        //       defaultMessage: 'Unable to unmute your microphone'\n        //     })\n        //   }));\n      }\n    }\n  }\n\n\n  async changeAudioOutputDevice(deviceId) {\n    this.logger.debug('changeAudioOutputDevice() [deviceId:\"%s\"]', deviceId);\n\n    // store.dispatch(\n    //   meActions.setAudioOutputInProgress(true));\n\n    try {\n      const device = this._audioOutputDevices[deviceId];\n\n      if (!device)\n        throw new Error('Selected audio output device no longer available');\n\n      // store.dispatch(settingsActions.setSelectedAudioOutputDevice(deviceId));\n\n      await this._updateAudioOutputDevices();\n    }\n    catch (error) {\n      this.logger.error('changeAudioOutputDevice() [error:\"%o\"]', error);\n    }\n\n    // store.dispatch(\n    //   meActions.setAudioOutputInProgress(false));\n  }\n\n  // Only Firefox supports applyConstraints to audio tracks\n  // See:\n  // https://bugs.chromium.org/p/chromium/issues/detail?id=796964\n  async updateMic({\n    start = false,\n    restart = false || this._device.flag !== 'firefox',\n    newDeviceId = null\n  } = {}) {\n    this.logger.debug(\n      'updateMic() [start:\"%s\", restart:\"%s\", newDeviceId:\"%s\"]',\n      start,\n      restart,\n      newDeviceId\n    );\n\n    let track;\n\n    try {\n      if (!this._mediasoupDevice.canProduce('audio'))\n        throw new Error('cannot produce audio');\n\n      if (newDeviceId && !restart)\n        throw new Error('changing device requires restart');\n\n      // if (newDeviceId)\n      //   store.dispatch(settingsActions.setSelectedAudioDevice(newDeviceId));\n\n      // store.dispatch(meActions.setAudioInProgress(true));\n\n      const deviceId = await this._getAudioDeviceId();\n      const device = this._audioDevices[deviceId];\n\n      if (!device)\n        throw new Error('no audio devices');\n\n      const autoGainControl = false;\n      const echoCancellation = true\n      const noiseSuppression = true\n\n      // if (!window.config.centralAudioOptions) {\n      //   throw new Error(\n      //     'Missing centralAudioOptions from app config! (See it in example config.)'\n      //   );\n      // }\n\n      const {\n        sampleRate = 96000,\n        channelCount = 1,\n        volume = 1.0,\n        sampleSize = 16,\n        opusStereo = false,\n        opusDtx = true,\n        opusFec = true,\n        opusPtime = 20,\n        opusMaxPlaybackRate = 96000\n      } = {};\n\n      if (\n        (restart && this._micProducer) ||\n        start\n      ) {\n        // this.disconnectLocalHark();\n\n        if (this._micProducer)\n          await this.disableMic();\n\n        const stream = await navigator.mediaDevices.getUserMedia(\n          {\n            audio: {\n              deviceId: { ideal: deviceId },\n              sampleRate,\n              channelCount,\n              // @ts-ignore\n              volume,\n              autoGainControl,\n              echoCancellation,\n              noiseSuppression,\n              sampleSize\n            }\n          }\n        );\n\n        ([track] = stream.getAudioTracks());\n\n        const { deviceId: trackDeviceId } = track.getSettings();\n\n        // store.dispatch(settingsActions.setSelectedAudioDevice(trackDeviceId));\n\n        this._micProducer = await this._sendTransport.produce(\n          {\n            track,\n            codecOptions:\n            {\n              opusStereo,\n              opusDtx,\n              opusFec,\n              opusPtime,\n              opusMaxPlaybackRate\n            },\n            appData:\n              { source: 'mic' }\n          });\n\n        // store.dispatch(producerActions.addProducer(\n        //   {\n        //     id: this._micProducer.id,\n        //     source: 'mic',\n        //     paused: this._micProducer.paused,\n        //     track: this._micProducer.track,\n        //     rtpParameters: this._micProducer.rtpParameters,\n        //     codec: this._micProducer.rtpParameters.codecs[0].mimeType.split('/')[1]\n        //   }));\n\n        this._micProducer.on('transportclose', () => {\n          this._micProducer = null;\n        });\n\n        this._micProducer.on('trackended', () => {\n          // store.dispatch(requestActions.notify(\n          //   {\n          //     type: 'error',\n          //     text: intl.formatMessage({\n          //       id: 'devices.microphoneDisconnected',\n          //       defaultMessage: 'Microphone disconnected'\n          //     })\n          //   }));\n\n          this.disableMic();\n        });\n\n        this._micProducer.volume = 0;\n\n        // this.connectLocalHark(track);\n      }\n      else if (this._micProducer) {\n        ({ track } = this._micProducer);\n\n        await track.applyConstraints(\n          {\n            sampleRate,\n            channelCount,\n            volume,\n            autoGainControl,\n            echoCancellation,\n            noiseSuppression,\n            sampleSize\n          }\n        );\n\n        if (this._harkStream != null) {\n          const [harkTrack] = this._harkStream.getAudioTracks();\n\n          harkTrack && await harkTrack.applyConstraints(\n            {\n              sampleRate,\n              channelCount,\n              volume,\n              autoGainControl,\n              echoCancellation,\n              noiseSuppression,\n              sampleSize\n            }\n          );\n        }\n      }\n\n      await this._updateAudioDevices();\n    }\n    catch (error) {\n      this.logger.error('updateMic() [error:\"%o\"]', error);\n\n      // store.dispatch(requestActions.notify(\n      //   {\n      //     type: 'error',\n      //     text: intl.formatMessage({\n      //       id: 'devices.microphoneError',\n      //       defaultMessage: 'An error occurred while accessing your microphone'\n      //     })\n      //   }));\n\n      if (track)\n        track.stop();\n    }\n\n    // store.dispatch(meActions.setAudioInProgress(false));\n  }\n\n  async updateWebcam({\n    init = false,\n    start = false,\n    restart = false,\n    newDeviceId = null,\n    newResolution = null,\n    newFrameRate = null\n  } = {}) {\n    this.logger.debug(\n      'updateWebcam() [start:\"%s\", restart:\"%s\", newDeviceId:\"%s\", newResolution:\"%s\", newFrameRate:\"%s\"]',\n      start,\n      restart,\n      newDeviceId,\n      newResolution,\n      newFrameRate\n    );\n\n    let track;\n\n    try {\n      if (!this._mediasoupDevice.canProduce('video'))\n        throw new Error('cannot produce video');\n\n      if (newDeviceId && !restart)\n        throw new Error('changing device requires restart');\n\n      // if (newDeviceId)\n      //   store.dispatch(settingsActions.setSelectedWebcamDevice(newDeviceId));\n\n      // if (newResolution)\n      //   store.dispatch(settingsActions.setVideoResolution(newResolution));\n\n      // if (newFrameRate)\n      //   store.dispatch(settingsActions.setVideoFrameRate(newFrameRate));\n\n      const  videoMuted  = false\n\n      if (init && videoMuted)\n        return;\n      // else\n        // store.dispatch(settingsActions.setVideoMuted(false));\n\n      // store.dispatch(meActions.setWebcamInProgress(true));\n\n      const deviceId = await this._getWebcamDeviceId();\n      const device = this._webcams[deviceId];\n\n      if (!device)\n        throw new Error('no webcam devices');\n\n      const  resolution = 'medium'\n      const frameRate = 15\n\n\n\n      if (\n        (restart && this._webcamProducer) ||\n        start\n      ) {\n        if (this._webcamProducer)\n          await this.disableWebcam();\n\n        const stream = await navigator.mediaDevices.getUserMedia(\n          {\n            video:\n            {\n              deviceId: { ideal: deviceId },\n              ...VIDEO_CONSTRAINS[resolution],\n              frameRate\n            }\n          });\n\n        ([track] = stream.getVideoTracks());\n\n        const { deviceId: trackDeviceId } = track.getSettings();\n\n        // store.dispatch(settingsActions.setSelectedWebcamDevice(trackDeviceId));\n\n        if (this._useSimulcast) {\n          // If VP9 is the only available video codec then use SVC.\n          const firstVideoCodec = this._mediasoupDevice\n            .rtpCapabilities\n            .codecs\n            .find((c) => c.kind === 'video');\n\n          let encodings;\n\n          if (firstVideoCodec.mimeType.toLowerCase() === 'video/vp9')\n            encodings = VIDEO_KSVC_ENCODINGS;\n          else if (simulcastEncodings)\n            encodings = simulcastEncodings;\n          else\n            encodings = VIDEO_SIMULCAST_ENCODINGS;\n\n          this._webcamProducer = await this._sendTransport.produce(\n            {\n              track,\n              encodings,\n              codecOptions:\n              {\n                videoGoogleStartBitrate: 1000\n              },\n              appData:\n              {\n                source: 'webcam'\n              }\n            });\n        }\n        else {\n          this._webcamProducer = await this._sendTransport.produce({\n            track,\n            appData:\n            {\n              source: 'webcam'\n            }\n          });\n        }\n\n        // store.dispatch(producerActions.addProducer(\n        //   {\n        //     id: this._webcamProducer.id,\n        //     source: 'webcam',\n        //     paused: this._webcamProducer.paused,\n        //     track: this._webcamProducer.track,\n        //     rtpParameters: this._webcamProducer.rtpParameters,\n        //     codec: this._webcamProducer.rtpParameters.codecs[0].mimeType.split('/')[1]\n        //   }));\n\n\n        const webCamStream = new Stream()\n        webCamStream.setProducer(this._webcamProducer);\n\n        this.onCamProducing.next(webCamStream)\n\n        this._webcamProducer.on('transportclose', () => {\n          this._webcamProducer = null;\n        });\n\n        this._webcamProducer.on('trackended', () => {\n          // store.dispatch(requestActions.notify(\n          //   {\n          //     type: 'error',\n          //     text: intl.formatMessage({\n          //       id: 'devices.cameraDisconnected',\n          //       defaultMessage: 'Camera disconnected'\n          //     })\n          //   }));\n\n          this.disableWebcam();\n        });\n      }\n      else if (this._webcamProducer) {\n        ({ track } = this._webcamProducer);\n\n        await track.applyConstraints(\n          {\n            ...VIDEO_CONSTRAINS[resolution],\n            frameRate\n          }\n        );\n\n        // Also change resolution of extra video producers\n        for (const producer of this._extraVideoProducers.values()) {\n          ({ track } = producer);\n\n          await track.applyConstraints(\n            {\n              ...VIDEO_CONSTRAINS[resolution],\n              frameRate\n            }\n          );\n        }\n      }\n\n      await this._updateWebcams();\n    }\n    catch (error) {\n      this.logger.error('updateWebcam() [error:\"%o\"]', error);\n\n      // store.dispatch(requestActions.notify(\n      //   {\n      //     type: 'error',\n      //     text: intl.formatMessage({\n      //       id: 'devices.cameraError',\n      //       defaultMessage: 'An error occurred while accessing your camera'\n      //     })\n      //   }));\n\n      if (track)\n        track.stop();\n    }\n\n    // store.dispatch(\n    //   meActions.setWebcamInProgress(false));\n  }\n\n  async closeMeeting() {\n    this.logger.debug('closeMeeting()');\n\n    // store.dispatch(\n    //   roomActions.setCloseMeetingInProgress(true));\n\n    try {\n      await this.signalingService.sendRequest('moderator:closeMeeting');\n    }\n    catch (error) {\n      this.logger.error('closeMeeting() [error:\"%o\"]', error);\n    }\n\n    // store.dispatch(\n    //   roomActions.setCloseMeetingInProgress(false));\n  }\n\n  // // type: mic/webcam/screen\n  // // mute: true/false\n  async modifyPeerConsumer(peerId, type, mute) {\n    this.logger.debug(\n      'modifyPeerConsumer() [peerId:\"%s\", type:\"%s\"]',\n      peerId,\n      type\n    );\n\n    // if (type === 'mic')\n    //   store.dispatch(\n    //     peerActions.setPeerAudioInProgress(peerId, true));\n    // else if (type === 'webcam')\n    //   store.dispatch(\n    //     peerActions.setPeerVideoInProgress(peerId, true));\n    // else if (type === 'screen')\n    //   store.dispatch(\n    //     peerActions.setPeerScreenInProgress(peerId, true));\n\n    try {\n      for (const consumer of this._consumers.values()) {\n        if (consumer.appData.peerId === peerId && consumer.appData.source === type) {\n          if (mute)\n            await this._pauseConsumer(consumer);\n          else\n            await this._resumeConsumer(consumer);\n        }\n      }\n    }\n    catch (error) {\n      this.logger.error('modifyPeerConsumer() [error:\"%o\"]', error);\n    }\n\n    // if (type === 'mic')\n    //   store.dispatch(\n    //     peerActions.setPeerAudioInProgress(peerId, false));\n    // else if (type === 'webcam')\n    //   store.dispatch(\n    //     peerActions.setPeerVideoInProgress(peerId, false));\n    // else if (type === 'screen')\n    //   store.dispatch(\n    //     peerActions.setPeerScreenInProgress(peerId, false));\n  }\n\n  async _pauseConsumer(consumer) {\n    this.logger.debug('_pauseConsumer() [consumer:\"%o\"]', consumer);\n\n    if (consumer.paused || consumer.closed)\n      return;\n\n    try {\n      await this.signalingService.sendRequest('pauseConsumer', { consumerId: consumer.id });\n\n      consumer.pause();\n\n      // store.dispatch(\n      //   consumerActions.setConsumerPaused(consumer.id, 'local'));\n    }\n    catch (error) {\n      this.logger.error('_pauseConsumer() [error:\"%o\"]', error);\n    }\n  }\n\n  async _resumeConsumer(consumer) {\n    this.logger.debug('_resumeConsumer() [consumer:\"%o\"]', consumer);\n\n    if (!consumer.paused || consumer.closed)\n      return;\n\n    try {\n      await this.signalingService.sendRequest('resumeConsumer', { consumerId: consumer.id });\n\n      consumer.resume();\n\n      // store.dispatch(\n      //   consumerActions.setConsumerResumed(consumer.id, 'local'));\n    }\n    catch (error) {\n      this.logger.error('_resumeConsumer() [error:\"%o\"]', error);\n    }\n  }\n\n  // async setMaxSendingSpatialLayer(spatialLayer) {\n  //   logger.debug('setMaxSendingSpatialLayer() [spatialLayer:\"%s\"]', spatialLayer);\n\n  //   try {\n  //     if (this._webcamProducer)\n  //       await this._webcamProducer.setMaxSpatialLayer(spatialLayer);\n  //     if (this._screenSharingProducer)\n  //       await this._screenSharingProducer.setMaxSpatialLayer(spatialLayer);\n  //   }\n  //   catch (error) {\n  //     logger.error('setMaxSendingSpatialLayer() [error:\"%o\"]', error);\n  //   }\n  // }\n\n  // async setConsumerPreferredLayers(consumerId, spatialLayer, temporalLayer) {\n  //   logger.debug(\n  //     'setConsumerPreferredLayers() [consumerId:\"%s\", spatialLayer:\"%s\", temporalLayer:\"%s\"]',\n  //     consumerId, spatialLayer, temporalLayer);\n\n  //   try {\n  //     await this.sendRequest(\n  //       'setConsumerPreferedLayers', { consumerId, spatialLayer, temporalLayer });\n\n  //     store.dispatch(consumerActions.setConsumerPreferredLayers(\n  //       consumerId, spatialLayer, temporalLayer));\n  //   }\n  //   catch (error) {\n  //     logger.error('setConsumerPreferredLayers() [error:\"%o\"]', error);\n  //   }\n  // }\n\n  // async setConsumerPriority(consumerId, priority) {\n  //   logger.debug(\n  //     'setConsumerPriority() [consumerId:\"%s\", priority:%d]',\n  //     consumerId, priority);\n\n  //   try {\n  //     await this.sendRequest('setConsumerPriority', { consumerId, priority });\n\n  //     store.dispatch(consumerActions.setConsumerPriority(consumerId, priority));\n  //   }\n  //   catch (error) {\n  //     logger.error('setConsumerPriority() [error:\"%o\"]', error);\n  //   }\n  // }\n\n  // async requestConsumerKeyFrame(consumerId) {\n  //   logger.debug('requestConsumerKeyFrame() [consumerId:\"%s\"]', consumerId);\n\n  //   try {\n  //     await this.sendRequest('requestConsumerKeyFrame', { consumerId });\n  //   }\n  //   catch (error) {\n  //     logger.error('requestConsumerKeyFrame() [error:\"%o\"]', error);\n  //   }\n  // }\n\n\n\n\n  async join({ roomId, joinVideo, joinAudio }) {\n\n\n    this._roomId = roomId;\n\n\n    // initialize signaling socket\n    // listen to socket events\n    this.signalingService.init(roomId, this._peerId)\n    this.signalingService.onDisconnected.subscribe( () => {\n      // close\n      // this.close\n    })\n    this.signalingService.onReconnecting.subscribe( () => {\n      // close\n\n\n\n\n\t\t\tif (this._webcamProducer)\n\t\t\t{\n\t\t\t\tthis._webcamProducer.close();\n\n\t\t\t\t// store.dispatch(\n\t\t\t\t// \tproducerActions.removeProducer(this._webcamProducer.id));\n\n\t\t\t\tthis._webcamProducer = null;\n\t\t\t}\n\n\t\t\tif (this._micProducer)\n\t\t\t{\n\t\t\t\tthis._micProducer.close();\n\n\t\t\t\t// store.dispatch(\n\t\t\t\t// \tproducerActions.removeProducer(this._micProducer.id));\n\n\t\t\t\tthis._micProducer = null;\n\t\t\t}\n\n\t\t\tif (this._sendTransport)\n\t\t\t{\n\t\t\t\tthis._sendTransport.close();\n\n\t\t\t\tthis._sendTransport = null;\n\t\t\t}\n\n\t\t\tif (this._recvTransport)\n\t\t\t{\n\t\t\t\tthis._recvTransport.close();\n\n\t\t\t\tthis._recvTransport = null;\n\t\t\t}\n\n      this.remotePeersService.clearPeers();\n\n\n\t\t\t// store.dispatch(roomActions.setRoomState('connecting'));\n    })\n\n    this.signalingService.onNewConsumer.pipe(switchMap(async (data) => {\n      const {\n        peerId,\n        producerId,\n        id,\n        kind,\n        rtpParameters,\n        type,\n        appData,\n        producerPaused\n      } = data;\n\n      const consumer  = await this._recvTransport.consume(\n        {\n          id,\n          producerId,\n          kind,\n          rtpParameters,\n          appData : { ...appData, peerId } // Trick.\n        }) as mediasoupClient.types.Consumer;\n\n      // Store in the map.\n      this._consumers.set(consumer.id, consumer);\n\n      consumer.on('transportclose', () =>\n      {\n        this._consumers.delete(consumer.id);\n      });\n\n\n\n\n      this.remotePeersService.newConsumer(consumer,  peerId, type, producerPaused);\n\n      // We are ready. Answer the request so the server will\n      // resume this Consumer (which was paused for now).\n\n\n      // if (kind === 'audio')\n      // {\n      //   consumer.volume = 0;\n\n      //   const stream = new MediaStream();\n\n      //   stream.addTrack(consumer.track);\n\n      //   if (!stream.getAudioTracks()[0])\n      //     throw new Error('request.newConsumer | given stream has no audio track');\n\n        // consumer.hark = hark(stream, { play: false });\n\n        // consumer.hark.on('volume_change', (volume) =>\n        // {\n        //   volume = Math.round(volume);\n\n        //   if (consumer && volume !== consumer.volume)\n        //   {\n        //     consumer.volume = volume;\n\n        //     // store.dispatch(peerVolumeActions.setPeerVolume(peerId, volume));\n        //   }\n        // });\n      // }\n\n    })).subscribe()\n\n    this.signalingService.onNotification.pipe(switchMap(async (notification) => {\n      this.logger.debug(\n        'socket \"notification\" event [method:\"%s\", data:\"%o\"]',\n        notification.method, notification.data);\n\n      try {\n        switch (notification.method) {\n\n\n\n          case 'producerScore':\n            {\n              const { producerId, score } = notification.data;\n\n              // store.dispatch(\n              //   producerActions.setProducerScore(producerId, score));\n\n              break;\n            }\n\n          case 'newPeer':\n            {\n              const { id, displayName, picture, roles } = notification.data;\n\n              // store.dispatch(peerActions.addPeer(\n              //   { id, displayName, picture, roles, consumers: [] }));\n\n              this.remotePeersService.newPeer(id);\n\n              // this._soundNotification();\n\n              // store.dispatch(requestActions.notify(\n              //   {\n              //     text: intl.formatMessage({\n              //       id: 'room.newPeer',\n              //       defaultMessage: '{displayName} joined the room'\n              //     }, {\n              //       displayName\n              //     })\n              //   }));\n\n              break;\n            }\n\n          case 'peerClosed':\n            {\n              const { peerId } = notification.data;\n\n              this.remotePeersService.closePeer(peerId);\n\n              // store.dispatch(\n              //   peerActions.removePeer(peerId));\n\n              break;\n            }\n\n          case 'consumerClosed':\n            {\n              const { consumerId } = notification.data;\n              const consumer = this._consumers.get(consumerId);\n\n              if (!consumer)\n                break;\n\n              consumer.close();\n\n              if (consumer.hark != null)\n                consumer.hark.stop();\n\n              this._consumers.delete(consumerId);\n\n              const { peerId } = consumer.appData;\n\n              // store.dispatch(\n              //   consumerActions.removeConsumer(consumerId, peerId));\n\n              break;\n            }\n\n          case 'consumerPaused':\n            {\n              const { consumerId } = notification.data;\n              const consumer = this._consumers.get(consumerId);\n\n              if (!consumer)\n                break;\n\n              // store.dispatch(\n              //   consumerActions.setConsumerPaused(consumerId, 'remote'));\n\n              break;\n            }\n\n          case 'consumerResumed':\n            {\n              const { consumerId } = notification.data;\n              const consumer = this._consumers.get(consumerId);\n\n              if (!consumer)\n                break;\n\n              // store.dispatch(\n              //   consumerActions.setConsumerResumed(consumerId, 'remote'));\n\n              break;\n            }\n\n          case 'consumerLayersChanged':\n            {\n              const { consumerId, spatialLayer, temporalLayer } = notification.data;\n              const consumer = this._consumers.get(consumerId);\n\n              if (!consumer)\n                break;\n\n              this.remotePeersService.onConsumerLayerChanged(consumerId)\n              // store.dispatch(consumerActions.setConsumerCurrentLayers(\n              //   consumerId, spatialLayer, temporalLayer));\n\n              break;\n            }\n\n          case 'consumerScore':\n            {\n              const { consumerId, score } = notification.data;\n\n              // store.dispatch(\n              //   consumerActions.setConsumerScore(consumerId, score));\n\n              break;\n            }\n            case 'roomBack':\n              {\n                await this._joinRoom({ joinVideo, joinAudio });\n\n                break;\n              }\n\n              case 'roomReady':\n                {\n                  const { turnServers } = notification.data;\n\n                  this._turnServers = turnServers;\n\n                  // store.dispatch(roomActions.toggleJoined());\n                  // store.dispatch(roomActions.setInLobby(false));\n\n                  await this._joinRoom({ joinVideo, joinAudio });\n\n                  break;\n                }\n          default:\n            {\n              // this.logger.error(\n              //   'unknown notification.method \"%s\"', notification.method);\n            }\n        }\n      }\n      catch (error) {\n        this.logger.error('error on socket \"notification\" event [error:\"%o\"]', error);\n\n        // store.dispatch(requestActions.notify(\n        //   {\n        //     type: 'error',\n        //     text: intl.formatMessage({\n        //       id: 'socket.requestError',\n        //       defaultMessage: 'Error on server request'\n        //     })\n        //   }));\n      }\n\n    })).subscribe()\n    // on room ready join room _joinRoom\n\n    // this._mediasoupDevice = new mediasoupClient.Device();\n\n    // const routerRtpCapabilities =\n    //   await this.sendRequest('getRouterRtpCapabilities');\n\n    // routerRtpCapabilities.headerExtensions = routerRtpCapabilities.headerExtensions\n    //   .filter((ext) => ext.uri !== 'urn:3gpp:video-orientation');\n\n    // await this._mediasoupDevice.load({ routerRtpCapabilities });\n\n    // create send transport createWebRtcTransport this.signalingService.sendCreateTransport\n    // listen to transport events\n\n    // create receive transport this.signalingService.sendCreateTranspor\n    // listen to transport events\n\n    // send join request\n\n    // add peers to peers service\n\n    // produce updateWebcam updateMic\n  }\n\n\n\tasync _updateAudioDevices()\n\t{\n\t\tthis.logger.debug('_updateAudioDevices()');\n\n\t\t// Reset the list.\n\t\tthis._audioDevices = {};\n\n\t\ttry\n\t\t{\n\t\t\tthis.logger.debug('_updateAudioDevices() | calling enumerateDevices()');\n\n\t\t\tconst devices = await navigator.mediaDevices.enumerateDevices();\n\n\t\t\tfor (const device of devices)\n\t\t\t{\n\t\t\t\tif (device.kind !== 'audioinput')\n\t\t\t\t\tcontinue;\n\n\t\t\t\tthis._audioDevices[device.deviceId] = device;\n\t\t\t}\n\n\t\t\t// store.dispatch(\n\t\t\t// \tmeActions.setAudioDevices(this._audioDevices));\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tthis.logger.error('_updateAudioDevices() [error:\"%o\"]', error);\n\t\t}\n\t}\n\n\tasync _updateWebcams()\n\t{\n\t\tthis.logger.debug('_updateWebcams()');\n\n\t\t// Reset the list.\n\t\tthis._webcams = {};\n\n\t\ttry\n\t\t{\n\t\t\tthis.logger.debug('_updateWebcams() | calling enumerateDevices()');\n\n\t\t\tconst devices = await navigator.mediaDevices.enumerateDevices();\n\n\t\t\tfor (const device of devices)\n\t\t\t{\n\t\t\t\tif (device.kind !== 'videoinput')\n\t\t\t\t\tcontinue;\n\n\t\t\t\tthis._webcams[device.deviceId] = device;\n\t\t\t}\n\n\t\t\t// store.dispatch(\n\t\t\t// \tmeActions.setWebcamDevices(this._webcams));\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tthis.logger.error('_updateWebcams() [error:\"%o\"]', error);\n\t\t}\n\t}\n\n\tasync disableWebcam()\n\t{\n\t\tthis.logger.debug('disableWebcam()');\n\n\t\tif (!this._webcamProducer)\n\t\t\treturn;\n\n\t\t// store.dispatch(meActions.setWebcamInProgress(true));\n\n\t\tthis._webcamProducer.close();\n\n\t\t// store.dispatch(\n\t\t// \tproducerActions.removeProducer(this._webcamProducer.id));\n\n\t\ttry\n\t\t{\n\t\t\tawait this.signalingService.sendRequest(\n\t\t\t\t'closeProducer', { producerId: this._webcamProducer.id });\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tthis.logger.error('disableWebcam() [error:\"%o\"]', error);\n\t\t}\n\n\t\tthis._webcamProducer = null;\n\t\t// store.dispatch(settingsActions.setVideoMuted(true));\n\t\t// store.dispatch(meActions.setWebcamInProgress(false));\n\t}\n\tasync disableMic()\n\t{\n\t\tthis.logger.debug('disableMic()');\n\n\t\tif (!this._micProducer)\n\t\t\treturn;\n\n\t\t// store.dispatch(meActions.setAudioInProgress(true));\n\n\t\tthis._micProducer.close();\n\n\t\t// store.dispatch(\n\t\t// \tproducerActions.removeProducer(this._micProducer.id));\n\n\t\ttry\n\t\t{\n\t\t\tawait this.signalingService.sendRequest(\n\t\t\t\t'closeProducer', { producerId: this._micProducer.id });\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tthis.logger.error('disableMic() [error:\"%o\"]', error);\n\t\t}\n\n\t\tthis._micProducer = null;\n\n\t\t// store.dispatch(meActions.setAudioInProgress(false));\n  }\n\n\n\tasync _getWebcamDeviceId()\n\t{\n\t\tthis.logger.debug('_getWebcamDeviceId()');\n\n\t\ttry\n\t\t{\n\t\t\tthis.logger.debug('_getWebcamDeviceId() | calling _updateWebcams()');\n\n\t\t\tawait this._updateWebcams();\n\n\t\t\tconst  selectedWebcam =  null\n\n\t\t\tif (selectedWebcam && this._webcams[selectedWebcam])\n\t\t\t\treturn selectedWebcam;\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst webcams = Object.values(this._webcams);\n\n        // @ts-ignore\n\t\t\t\treturn webcams[0] ? webcams[0].deviceId : null;\n\t\t\t}\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tthis.logger.error('_getWebcamDeviceId() [error:\"%o\"]', error);\n\t\t}\n  }\n\n\n\tasync _getAudioDeviceId()\n\t{\n\t\tthis.logger.debug('_getAudioDeviceId()');\n\n\t\ttry\n\t\t{\n\t\t\tthis.logger.debug('_getAudioDeviceId() | calling _updateAudioDeviceId()');\n\n\t\t\tawait this._updateAudioDevices();\n\n      const  selectedAudioDevice = null;\n\n\t\t\tif (selectedAudioDevice && this._audioDevices[selectedAudioDevice])\n\t\t\t\treturn selectedAudioDevice;\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst audioDevices = Object.values(this._audioDevices);\n\n        // @ts-ignore\n\t\t\t\treturn audioDevices[0] ? audioDevices[0].deviceId : null;\n\t\t\t}\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tthis.logger.error('_getAudioDeviceId() [error:\"%o\"]', error);\n\t\t}\n\t}\n\n\tasync _updateAudioOutputDevices()\n\t{\n\t\tthis.logger.debug('_updateAudioOutputDevices()');\n\n\t\t// Reset the list.\n\t\tthis._audioOutputDevices = {};\n\n\t\ttry\n\t\t{\n\t\t\tthis.logger.debug('_updateAudioOutputDevices() | calling enumerateDevices()');\n\n\t\t\tconst devices = await navigator.mediaDevices.enumerateDevices();\n\n\t\t\tfor (const device of devices)\n\t\t\t{\n\t\t\t\tif (device.kind !== 'audiooutput')\n\t\t\t\t\tcontinue;\n\n\t\t\t\tthis._audioOutputDevices[device.deviceId] = device;\n\t\t\t}\n\n\t\t\t// store.dispatch(\n\t\t\t// \tmeActions.setAudioOutputDevices(this._audioOutputDevices));\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tthis.logger.error('_updateAudioOutputDevices() [error:\"%o\"]', error);\n\t\t}\n\t}\n\n\n\n  async _joinRoom({ joinVideo, joinAudio }) {\n    this.logger.debug('_joinRoom()');\n\n    const displayName = `Guest ${Math.floor(Math.random() * (100000 - 10000)) + 10000}`\n\n\n    try {\n\n\n      this._mediasoupDevice = new mediasoupClient.Device();\n\n      const routerRtpCapabilities =\n        await this.signalingService.sendRequest('getRouterRtpCapabilities');\n\n      routerRtpCapabilities.headerExtensions = routerRtpCapabilities.headerExtensions\n        .filter((ext) => ext.uri !== 'urn:3gpp:video-orientation');\n\n      await this._mediasoupDevice.load({ routerRtpCapabilities });\n\n      if (this._produce) {\n        const transportInfo = await this.signalingService.sendRequest(\n          'createWebRtcTransport',\n          {\n            forceTcp: this._forceTcp,\n            producing: true,\n            consuming: false\n          });\n\n        const {\n          id,\n          iceParameters,\n          iceCandidates,\n          dtlsParameters\n        } = transportInfo;\n\n        this._sendTransport = this._mediasoupDevice.createSendTransport(\n          {\n            id,\n            iceParameters,\n            iceCandidates,\n            dtlsParameters,\n            iceServers: this._turnServers,\n            // TODO: Fix for issue #72\n            iceTransportPolicy: this._device.flag === 'firefox' && this._turnServers ? 'relay' : undefined,\n            proprietaryConstraints: PC_PROPRIETARY_CONSTRAINTS\n          });\n\n        this._sendTransport.on(\n          'connect', ({ dtlsParameters }, callback, errback) => // eslint-disable-line no-shadow\n        {\n          this.signalingService.sendRequest(\n            'connectWebRtcTransport',\n            {\n              transportId: this._sendTransport.id,\n              dtlsParameters\n            })\n            .then(callback)\n            .catch(errback);\n        });\n\n        this._sendTransport.on(\n          'produce', async ({ kind, rtpParameters, appData }, callback, errback) => {\n          try {\n            // eslint-disable-next-line no-shadow\n            const { id } = await this.signalingService.sendRequest(\n              'produce',\n              {\n                transportId: this._sendTransport.id,\n                kind,\n                rtpParameters,\n                appData\n              });\n\n            callback({ id });\n          }\n          catch (error) {\n            errback(error);\n          }\n        });\n      }\n\n      const transportInfo = await this.signalingService.sendRequest(\n        'createWebRtcTransport',\n        {\n          forceTcp: this._forceTcp,\n          producing: false,\n          consuming: true\n        });\n\n      const {\n        id,\n        iceParameters,\n        iceCandidates,\n        dtlsParameters\n      } = transportInfo;\n\n      this._recvTransport = this._mediasoupDevice.createRecvTransport(\n        {\n          id,\n          iceParameters,\n          iceCandidates,\n          dtlsParameters,\n          iceServers: this._turnServers,\n          // TODO: Fix for issue #72\n          iceTransportPolicy: this._device.flag === 'firefox' && this._turnServers ? 'relay' : undefined\n        });\n\n      this._recvTransport.on(\n        'connect', ({ dtlsParameters }, callback, errback) => // eslint-disable-line no-shadow\n      {\n        this.signalingService.sendRequest(\n          'connectWebRtcTransport',\n          {\n            transportId: this._recvTransport.id,\n            dtlsParameters\n          })\n          .then(callback)\n          .catch(errback);\n      });\n\n      // Set our media capabilities.\n      // store.dispatch(meActions.setMediaCapabilities(\n      // \t{\n      // \t\tcanSendMic     : this._mediasoupDevice.canProduce('audio'),\n      // \t\tcanSendWebcam  : this._mediasoupDevice.canProduce('video'),\n      // \t\tcanShareScreen : this._mediasoupDevice.canProduce('video') &&\n      // \t\t\tthis._screenSharing.isScreenShareAvailable(),\n      // \t\tcanShareFiles : this._torrentSupport\n      // \t}));\n\n      const {\n        authenticated,\n        roles,\n        peers,\n        tracker,\n        roomPermissions,\n        userRoles,\n        allowWhenRoleMissing,\n        chatHistory,\n        fileHistory,\n        lastNHistory,\n        locked,\n        lobbyPeers,\n        accessCode\n      } = await this.signalingService.sendRequest(\n        'join',\n        {\n          displayName: displayName,\n\n          rtpCapabilities: this._mediasoupDevice.rtpCapabilities\n        });\n\n      this.logger.debug(\n        '_joinRoom() joined [authenticated:\"%s\", peers:\"%o\", roles:\"%o\", userRoles:\"%o\"]',\n        authenticated,\n        peers,\n        roles,\n        userRoles\n      );\n\n\n\n\n\n      // for (const peer of peers)\n      // {\n      // \tstore.dispatch(\n      // \t\tpeerActions.addPeer({ ...peer, consumers: [] }));\n      // }\n\n        this.logger.debug('join audio',joinAudio , 'can produce audio',\n          this._mediasoupDevice.canProduce('audio'), ' this._muted', this._muted)\n      // Don't produce if explicitly requested to not to do it.\n      if (this._produce) {\n        if (\n          joinVideo\n        ) {\n          this.updateWebcam({ init: true, start: true });\n        }\n        if (\n          joinAudio &&\n          this._mediasoupDevice.canProduce('audio')\n        )\n          if (!this._muted) {\n            await this.updateMic({ start: true });\n\n          }\n      }\n\n      await this._updateAudioOutputDevices();\n\n      // const  selectedAudioOutputDevice  = null\n\n      // if (!selectedAudioOutputDevice && this._audioOutputDevices !== {})\n      // {\n      // \tstore.dispatch(\n      // \t\tsettingsActions.setSelectedAudioOutputDevice(\n      // \t\t\tObject.keys(this._audioOutputDevices)[0]\n      // \t\t)\n      // \t);\n      // }\n\n      // store.dispatch(roomActions.setRoomState('connected'));\n\n      // // Clean all the existing notifications.\n      // store.dispatch(notificationActions.removeAllNotifications());\n\n      // store.dispatch(requestActions.notify(\n      // \t{\n      // \t\ttext : intl.formatMessage({\n      // \t\t\tid             : 'room.joined',\n      // \t\t\tdefaultMessage : 'You have joined the room'\n      // \t\t})\n      // \t}));\n\n      this.remotePeersService.addPeers(peers);\n\n\n    }\n    catch (error) {\n      this.logger.error('_joinRoom() [error:\"%o\"]', error);\n\n\n      this.close();\n    }\n  }\n  deviceInfo() {\n    const ua = navigator.userAgent;\n    const browser = bowser.getParser(ua);\n\n    let flag;\n\n    if (browser.satisfies({ chrome: '>=0', chromium: '>=0' }))\n      flag = 'chrome';\n    else if (browser.satisfies({ firefox: '>=0' }))\n      flag = 'firefox';\n    else if (browser.satisfies({ safari: '>=0' }))\n      flag = 'safari';\n    else if (browser.satisfies({ opera: '>=0' }))\n      flag = 'opera';\n    else if (browser.satisfies({ 'microsoft edge': '>=0' }))\n      flag = 'edge';\n    else\n      flag = 'unknown';\n\n    return {\n      flag,\n      os: browser.getOSName(true), // ios, android, linux...\n      platform: browser.getPlatformType(true), // mobile, desktop, tablet\n      name: browser.getBrowserName(true),\n      version: browser.getBrowserVersion(),\n      bowser: browser\n    };\n\n  }\n}\n","/*\n * Public API Surface of hug-angular-lib\n */\n\nexport * from './lib/hug-angular-lib.component';\nexport * from './lib/hug-angular-lib.module';\nexport * from './lib/room.service'\nexport * from './lib/log.service'\nexport * from './lib/remote-peers.service';\nexport {LogService} from './lib/log.service'\n\nexport * from './lib/stream'\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":["i0.ɵɵelementStart","i0.ɵɵtext","i0.ɵɵelementEnd","LogService","mediasoupClient.Device"],"mappings":";;;;;;;;;;MAWa,sBAAsB;IAEjC,iBAAiB;IAEjB,QAAQ;KAEP;;4FANU,sBAAsB;wDAAtB,sBAAsB;QAN/BA,sBACE;QAAAC,oCACF;QAAAC,cAAI;;+CAIK,sBAAsB;cATlC,SAAS;eAAC;gBACT,QAAQ,EAAE,qBAAqB;gBAC/B,QAAQ,EAAE;;;;GAIT;gBACD,MAAM,EAAE,EAAE;aACX;;;ACVD;AAGA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;;ACNA,OAAO,CAAC,GAAG,CAAC,YAAY,CAAC,CAAA;MASZ,mBAAmB;;oDAAnB,mBAAmB;kHAAnB,mBAAmB,mBAHpB,CAACC,SAAU,CAAC,YAHb;YACP,YAAY,CAAC,OAAO,CAAC,EAAE,KAAK,EAAE,cAAc,CAAC,KAAK,EAAC,CAAC;SACrD;qFAIU,mBAAmB,mBAPf,sBAAsB,sCAK3B,sBAAsB;+CAErB,mBAAmB;cAR/B,QAAQ;eAAC;gBACR,YAAY,EAAE,CAAC,sBAAsB,CAAC;gBACtC,OAAO,EAAE;oBACP,YAAY,CAAC,OAAO,CAAC,EAAE,KAAK,EAAE,cAAc,CAAC,KAAK,EAAC,CAAC;iBACrD;gBACD,SAAS,EAAC,CAACA,SAAU,CAAC;gBACtB,OAAO,EAAE,CAAC,sBAAsB,CAAC;aAClC;;;MCLY,MAAM;IAAnB;QAOS,kBAAa,GAAiB,IAAI,OAAO,EAAE,CAAA;QAOlD,gBAAW,GAAgB,IAAI,WAAW,EAAE,CAAC;KAoB9C;IAlBC,WAAW,CAAC,QAAkC;QAC5C,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;QACzB,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC,EAAE,CAAA;QAC3B,IAAI,CAAC,IAAI,GAAG,QAAQ,CAAC,IAAI,CAAC;QAC1B,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;KAC3C;IAED,oBAAoB;QAClB,IAAI,CAAC,WAAW,GAAG,IAAI,WAAW,EAAE,CAAC;QACrC,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;QAC/C,IAAI,CAAC,aAAa,CAAC,IAAI,EAAE,CAAA;KAC1B;IAGD,WAAW,CAAC,QAAQ;QAClB,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAA;QACxB,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;KAC3C;;;ACjCH,MAAM,cAAc,GAAG,KAAK,CAAA;AAE5B;;;MAGa,kBAAmB,SAAQ,KAAK;IAE5C,YAAY,OAAO;QAElB,KAAK,CAAC,OAAO,CAAC,CAAC;QAEf,IAAI,CAAC,IAAI,GAAG,oBAAoB,CAAC;QAE/B,IAAI,KAAK,CAAC,cAAc,CAAC,mBAAmB,CAAC;;YAE9C,KAAK,CAAC,iBAAiB,CAAC,IAAI,EAAE,kBAAkB,CAAC,CAAC;;YAElD,IAAI,CAAC,KAAK,GAAG,CAAC,IAAI,KAAK,CAAC,OAAO,CAAC,EAAE,KAAK,CAAC;KACzC;CACD;MAKY,gBAAgB;IAc3B,YAAoB,MAAkB;QAAlB,WAAM,GAAN,MAAM,CAAY;QATtC,sBAAiB,GAAG,iBAAiB,CAAC;QAEtC,YAAO,GAAG,KAAK,CAAC;QAEhB,mBAAc,GAAiB,IAAI,OAAO,EAAE,CAAA;QAC5C,mBAAc,GAAiB,IAAI,OAAO,EAAE,CAAA;QAC5C,kBAAa,GAAiB,IAAI,OAAO,EAAE,CAAA;QAC3C,kBAAa,GAAiB,IAAI,OAAO,EAAE,CAAC;QAC5C,mBAAc,GAAiB,IAAI,OAAO,EAAE,CAAC;KAG3C;IAGF,IAAI,CAAC,MAAM,EAAE,MAAM;QAEjB,IAAI,CAAC,aAAa;YAClB,GAAG,IAAI,CAAC,iBAAiB,YAAY,MAAM,WAAW,MAAM,EAAE,CAAC;QAC/D,IAAI,CAAC,gBAAgB,GAAG,EAAE,CAAC,IAAI,CAAC,aAAa,CAAC,CAAA;QAC9C,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,oBAAoB,EAAE,IAAI,CAAC,aAAa,CAAC,CAAA;QAG7D,IAAI,CAAC,gBAAgB,CAAC,EAAE,CAAC,SAAS,EAAE;YAElC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,gCAAgC,CAAC,CAAC;SACnD,CAAC,CAAC;QAEH,IAAI,CAAC,gBAAgB,CAAC,EAAE,CAAC,YAAY,EAAE,CAAC,MAAM;YAE/C,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,iDAAiD,EAAE,MAAM,CAAC,CAAC;YAE5E,IAAI,IAAI,CAAC,OAAO;gBACf,OAAO;YAER,IAAI,MAAM,KAAK,sBAAsB,EACrC;gBACK,IAAI,CAAC,cAAc,CAAC,IAAI,EAAE,CAAA;gBAE9B,IAAI,CAAC,KAAK,EAAE,CAAC;aACb;YAEE,IAAI,CAAC,cAAc,CAAC,IAAI,CAAA;SAE3B,CAAC,CAAC;QAED,IAAI,CAAC,gBAAgB,CAAC,EAAE,CAAC,kBAAkB,EAAE;YAE9C,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,yCAAyC,CAAC,CAAC;YAEzD,IAAI,CAAC,cAAc,CAAC,IAAI,EAAE,CAAA;YAE7B,IAAI,CAAC,KAAK,EAAE,CAAC;SACX,CAAC,CAAC;QAGL,IAAI,CAAC,gBAAgB,CAAC,EAAE,CAAC,WAAW,EAAE,CAAC,aAAa;YAEnD,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,kDAAkD,EAAE,aAAa,CAAC,CAAC;YAElF,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,aAAa,CAAC,CAAA;;SAIzC,CAAC,CAAC;QAIH,IAAI,CAAC,gBAAgB,CAAC,EAAE,CAAC,SAAS,EAAE,CAAO,OAAO,EAAE,EAAE;YAErD,IAAI,CAAC,MAAM,CAAC,KAAK,CAChB,iDAAiD,EACjD,OAAO,CAAC,MAAM,EAAE,OAAO,CAAC,IAAI,CAAC,CAAC;YAG/B,QAAQ,OAAO,CAAC,MAAM;gBAErB,KAAK,aAAa;oBAClB;wBACQ,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;wBACtC,EAAE,EAAE,CAAA;wBAEX,MAAM;qBACN;gBAED;oBACA;wBACC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,6BAA6B,EAAE,OAAO,CAAC,MAAM,CAAC,CAAC;wBAEjE,EAAE,CAAC,GAAG,EAAE,2BAA2B,OAAO,CAAC,MAAM,GAAG,CAAC,CAAC;qBACtD;aACD;SACD,CAAA,CAAC,CAAC;QAED,IAAI,CAAC,gBAAgB,CAAC,EAAE,CAAC,cAAc,EAAE,CAAC,YAAY;YACpD,IAAI,CAAC,MAAM,CAAC,KAAK,CACf,sDAAsD,EACtD,YAAY,CAAC,MAAM,EAAE,YAAY,CAAC,IAAI,CAAC,CAAC;YAE1C,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,YAAY,CAAC,CAAA;SAEvC,CAAC,CAAC;KAIJ;IACD,KAAK;QACH,IAAI,IAAI,CAAC,OAAO;YACd,OAAO;QAET,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;QAEpB,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC;QAE7B,IAAI,CAAC,gBAAgB,CAAC,KAAK,EAAE,CAAC;KAG/B;IACF,eAAe,CAAC,QAAQ;QAEvB,IAAI,MAAM,GAAG,KAAK,CAAC;QAEnB,MAAM,QAAQ,GAAG,UAAU,CAC1B;YAEC,IAAI,MAAM;gBACT,OAAO;YACR,MAAM,GAAG,IAAI,CAAC;YACd,QAAQ,CAAC,IAAI,kBAAkB,CAAC,mBAAmB,CAAC,CAAC,CAAC;SACtD,EACD,cAAc,CACd,CAAC;QAEF,OAAO,CAAC,GAAG,IAAI;YAEd,IAAI,MAAM;gBACT,OAAO;YACR,MAAM,GAAG,IAAI,CAAC;YACd,YAAY,CAAC,QAAQ,CAAC,CAAC;YAEvB,QAAQ,CAAC,GAAG,IAAI,CAAC,CAAC;SAClB,CAAC;KACF;IAED,YAAY,CAAC,MAAM,EAAE,IAAI;QAExB,OAAO,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM;YAElC,IAAI,CAAC,IAAI,CAAC,gBAAgB,EAC1B;gBACC,MAAM,CAAC,sBAAsB,CAAC,CAAC;aAC/B;iBAED;gBACC,IAAI,CAAC,gBAAgB,CAAC,IAAI,CACzB,SAAS,EACT,EAAE,MAAM,EAAE,IAAI,EAAE,EAChB,IAAI,CAAC,eAAe,CAAC,CAAC,GAAG,EAAE,QAAQ;oBAElC,IAAI,GAAG;wBACN,MAAM,CAAC,GAAG,CAAC,CAAC;;wBAEZ,OAAO,CAAC,QAAQ,CAAC,CAAC;iBACnB,CAAC,CACF,CAAC;aACF;SACD,CAAC,CAAC;KACF;IAGW,WAAW,CAAC,MAAM,EAAE,IAAK;;YAErC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,wCAAwC,EAAE,MAAM,EAAE,IAAI,CAAC,CAAC;YAE1E,MAAM,cAAc,GAAG,CAAC,CAAA;YAGxB,KAAK,IAAI,KAAK,GAAG,CAAC,EAAE,KAAK,GAAG,cAAc,EAAE,KAAK,EAAE,EACnD;gBACC,IACA;oBACC,OAAO,MAAM,IAAI,CAAC,YAAY,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;iBAC7C;gBACD,OAAO,KAAK,EACZ;oBACC,IACC,KAAK,YAAY,kBAAkB;wBACnC,KAAK,GAAG,cAAc;wBAEtB,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,kDAAkD,EAAE,KAAK,CAAC,CAAC;;wBAE5E,MAAM,KAAK,CAAC;iBACb;aACD;SACD;KAAA;;gFAtMW,gBAAgB;qDAAhB,gBAAgB,WAAhB,gBAAgB,mBAFf,MAAM;+CAEP,gBAAgB;cAH5B,UAAU;eAAC;gBACV,UAAU,EAAE,MAAM;aACnB;;;MC9BY,IAAI;IAAjB;QAEE,YAAO,GAAW,EAAE,CAAA;KACrB;;;MCOY,kBAAkB;IAM7B,YAAoB,MAAkB;QAAlB,WAAM,GAAN,MAAM,CAAY;QAH/B,iBAAY,GAA4B,IAAI,eAAe,CAAC,EAAE,CAAC,CAAC;QAE/D,UAAK,GAAW,EAAE,CAAA;QAExB,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,YAAY,CAAC,YAAY,EAAE,CAAA;KACnD;IAGF,WAAW;QACT,UAAU,CAAC,MAAO,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,EAAK,CAAC,CAAC,CAAA;KAC5D;IAED,UAAU;QACR,IAAI,CAAC,YAAY,GAA4B,IAAI,eAAe,CAAC,EAAE,CAAC,CAAC;QACrE,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,YAAY,CAAC,YAAY,EAAE,CAAC;QACpD,IAAI,CAAC,KAAK,GAAG,EAAE,CAAA;KAChB;IACD,OAAO,CAAC,EAAE;QACR,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,UAAU,EAAE,EAAE,CAAC,CAAA;QACjC,MAAM,IAAI,GAAG,IAAI,IAAI,EAAE,CAAA;QACvB,IAAI,CAAC,EAAE,GAAG,EAAE,CAAC;QACb,IAAI,CAAC,OAAO,GAAG,EAAE,CAAA;QACjB,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAA;QAClB,IAAI,CAAC,WAAW,EAAE,CAAA;QAClB,OAAO,IAAI,CAAA;KACZ;IACD,SAAS,CAAC,EAAE;QACZ,IAAI,CAAC,MAAM,CAAC,KAAK,CAChB,qCAAqC,EAAE,EAAE,CAAC,CAAC;QAE1C,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,IAAI,KAAK,IAAI,CAAC,EAAE,KAAK,EAAE,CAAC,CAAC;QACzD,IAAI,CAAC,WAAW,EAAE,CAAA;KACnB;IAGD,OAAO,CAAC,IAAU;QAChB,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;KACtB;IAED,QAAQ,CAAC,KAAK;QACZ,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,YAAY,EAAE,KAAK,CAAC,CAAA;QACxC,KAAK,MAAM,IAAI,IAAI,KAAK,EACxB;YACC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,IAAE,IAAI,CAAC,EAAE,KAAK,CAAC,CAAC,EAAE,CAAC,EACzC;gBACC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,4BAA4B,EAAE,IAAI,CAAC,EAAE,CAAC,CAAC;gBACrD,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE,EAAE,EAAE,IAAI,CAAC,EAAE,EAAE,OAAO,EAAC,EAAE,EAAE,CAAC,CAAC;aACjD;SACD;QACD,IAAI,CAAC,WAAW,EAAE,CAAC;KAClB;IAED,WAAW,CAAC,QAAkC,EAAE,MAAc,EAAE,IAAI,EAAE,cAAc;QAElF,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,2BAA2B,EAAE,QAAQ,EAAE,MAAM,CAAC,CAAA;QAChE,IAAI,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,EAAE,KAAK,MAAM,CAAC,CAAA;QAEtD,IAAI,CAAC,IAAI,EAAE;YACT,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,qBAAqB,EAAE,MAAM,EAAE,IAAI,CAAC,KAAK,CAAC,CAAA;YAC3D,IAAI,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAA;SAC5B;QACD,MAAM,cAAc,GAAG,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,MAAM,cAAI,OAAA,OAAA,MAAM,CAAC,QAAQ,0CAAE,OAAO,CAAC,MAAM,MAAK,QAAQ,CAAC,OAAO,CAAC,MAAM,CAAA,EAAA,CAAC,CAAA;QAE/G,IAAI,cAAc,EAAE;YAClB,cAAc,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAA;SACrC;aAAM;YACL,MAAM,MAAM,GAAG,IAAI,MAAM,EAAE,CAAA;YAC3B,MAAM,CAAC,IAAI,GAAG,IAAI,CAAA;YAClB,MAAM,CAAC,IAAI,GAAG,IAAI,CAAC;YACnB,MAAM,CAAC,cAAc,GAAG,cAAc,CAAC;YACvC,MAAM,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAA;YAC5B,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,qBAAqB,EAAE,MAAM,CAAC,CAAA;YAChD,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,CAAA;SAC1B;QAED,IAAI,CAAC,WAAW,EAAE,CAAA;KAEnB;IAED,sBAAsB,CAAC,UAAU;QAI7B,MAAM,MAAM,GAAG,IAAI,CAAC,qBAAqB,CAAE,UAAU,CAAC,CAAA;QACtD,IAAI,MAAM,EAAE;YAEV,MAAM,CAAC,oBAAoB,EAAE,CAAA;SAC9B;KAEJ;IAGD,qBAAqB,CAAC,UAAkB;QACtC,KAAK,MAAM,IAAI,IAAI,IAAI,CAAC,KAAK,EAAE;YAC7B,MAAM,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC,QAAQ,CAAC,EAAE,KAAK,UAAU,CAAC,CAAA;YACnE,IAAI,MAAM,EAAE;gBACV,OAAO,MAAM,CAAA;aACd;SACF;QACD,OAAO,IAAI,CAAA;KACZ;;oFAvGU,kBAAkB;uDAAlB,kBAAkB,WAAlB,kBAAkB,mBAFjB,MAAM;+CAEP,kBAAkB;cAH9B,UAAU;eAAC;gBACV,UAAU,EAAE,MAAM;aACnB;;;ACID,IAAI,MAAM,CAAC;AAGX,MAAM,KAAK,GAAG,CAAC,CAAA;AACf,MAAM,WAAW,GAAG,CAAC,CAAA;AACrB,MAAM,gBAAgB,GAAG,KAAK,CAAA;AAE9B,MAAM,SAAS,GAAG,IAAI,CAAC;AACvB,MAAO,kBAAkB,GAAK;IAC5B,EAAE,qBAAqB,EAAE,CAAC,EAAE;IAC5B,EAAE,qBAAqB,EAAE,CAAC,EAAE;IAC5B,EAAE,qBAAqB,EAAE,CAAC,EAAE;CAC7B,CAAA;AAGD,MAAM,gBAAgB,GACtB;IACC,KAAK,EACL;QACC,KAAK,EAAS,EAAE,KAAK,EAAE,GAAG,EAAE;QAC5B,WAAW,EAAG,gBAAgB;KAC9B;IACD,QAAQ,EACR;QACC,KAAK,EAAS,EAAE,KAAK,EAAE,GAAG,EAAE;QAC5B,WAAW,EAAG,gBAAgB;KAC9B;IACD,MAAM,EACN;QACC,KAAK,EAAS,EAAE,KAAK,EAAE,IAAI,EAAE;QAC7B,WAAW,EAAG,gBAAgB;KAC9B;IACD,UAAU,EACV;QACC,KAAK,EAAS,EAAE,KAAK,EAAE,IAAI,EAAE;QAC7B,WAAW,EAAG,gBAAgB;KAC9B;IACD,OAAO,EACP;QACC,KAAK,EAAS,EAAE,KAAK,EAAE,IAAI,EAAE;QAC7B,WAAW,EAAG,gBAAgB;KAC9B;CACD,CAAC;AAEF,MAAM,0BAA0B,GAChC;IACC,QAAQ,EAAG,CAAE,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAE;CACjC,CAAC;AAEF,MAAM,yBAAyB,GAC/B;IACC,EAAE,qBAAqB,EAAE,CAAC,EAAE,UAAU,EAAE,MAAM,EAAE;IAChD,EAAE,qBAAqB,EAAE,CAAC,EAAE,UAAU,EAAE,OAAO,EAAE;CACjD,CAAC;AAEF;AACA,MAAM,oBAAoB,GAC1B;IACC,EAAE,eAAe,EAAE,UAAU,EAAE;CAC/B,CAAC;AAEF;AACA,MAAM,mBAAmB,GACzB;IACC,EAAE,eAAe,EAAE,MAAM,EAAE,GAAG,EAAE,IAAI,EAAE;CACtC,CAAC;MAMY,WAAW;IAmCvB,YACU,gBAAkC,EAClC,MAAkB,EACpB,kBAAsC;QAFpC,qBAAgB,GAAhB,gBAAgB,CAAkB;QAClC,WAAM,GAAN,MAAM,CAAY;QACpB,uBAAkB,GAAlB,kBAAkB,CAAoB;;QAjC9C,mBAAc,GAAG,IAAI,CAAC;;QAEtB,mBAAc,GAAG,IAAI,CAAC;QAEtB,YAAO,GAAG,KAAK,CAAC;QAEhB,aAAQ,GAAG,IAAI,CAAC;QAEhB,cAAS,GAAG,KAAK,CAAC;QAqBX,mBAAc,GAAiB,IAAI,OAAO,EAAE,CAAC;KAOnD;IAED,IAAI,CAAC,EACH,MAAM,GAAC,IAAI,EAEX,OAAO,GAAC,IAAI,EACZ,QAAQ,GAAC,KAAK,EACd,KAAK,GAAC,KAAK,EACZ,GAAG,EAAE;QACJ,IAAI,CAAC,MAAM;YACT,MAAM,IAAI,KAAK,CAAC,gBAAgB,CAAC,CAAC;;;;;QAWpC,IAAI,CAAC,QAAQ,GAAG,OAAO,CAAC;;QAGxB,IAAI,CAAC,SAAS,GAAG,QAAQ,CAAC;;;;;QAe1B,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;;QAGpB,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,UAAU,EAAE,CAAC;;QAGjC,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC;;;;QAWtB,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;;;QAIpB,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC;;QAI7B,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC;;QAG3B,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC;;QAG3B,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;;QAGzB,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;;QAGlB,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;;QAGxB,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC;;QAG5B,IAAI,CAAC,oBAAoB,GAAG,IAAI,GAAG,EAAE,CAAC;;;QAItC,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;QAEnB,IAAI,CAAC,aAAa,GAAG,EAAE,CAAC;QAExB,IAAI,CAAC,mBAAmB,GAAG,EAAE,CAAC;;;QAI9B,IAAI,CAAC,UAAU,GAAG,IAAI,GAAG,EAAE,CAAC;QAE5B,IAAI,CAAC,aAAa,GAAG,SAAS,CAAA;;;KAM/B;IACD,KAAK;QACH,IAAI,IAAI,CAAC,OAAO;YACd,OAAO;QAET,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;QAEpB,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC;QAE7B,IAAI,CAAC,gBAAgB,CAAC,KAAK,EAAE,CAAC;;QAG9B,IAAI,IAAI,CAAC,cAAc;YACrB,IAAI,CAAC,cAAc,CAAC,KAAK,EAAE,CAAC;QAE9B,IAAI,IAAI,CAAC,cAAc;YACrB,IAAI,CAAC,cAAc,CAAC,KAAK,EAAE,CAAC;KAG/B;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IA2GD,qBAAqB;QACnB,SAAS,CAAC,YAAY,CAAC,gBAAgB,CAAC,cAAc,EAAE;YACtD,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,iEAAiE,CAAC,CAAC;YAErF,MAAM,IAAI,CAAC,mBAAmB,EAAE,CAAC;YACjC,MAAM,IAAI,CAAC,cAAc,EAAE,CAAC;YAC5B,MAAM,IAAI,CAAC,yBAAyB,EAAE,CAAC;;;;;;;;SASxC,CAAA,CAAC,CAAC;KACJ;IAIK,OAAO;;YACX,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC;YAE/B,IAAI,CAAC,YAAY,CAAC,KAAK,EAAE,CAAC;YAE1B,IAAI;gBACF,MAAM,IAAI,CAAC,gBAAgB,CAAC,WAAW,CACrC,eAAe,EAAE,EAAE,UAAU,EAAE,IAAI,CAAC,YAAY,CAAC,EAAE,EAAE,CAAC,CAAC;;;;;aAQ1D;YACD,OAAO,KAAK,EAAE;gBACZ,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,wBAAwB,EAAE,KAAK,CAAC,CAAC;;;;;;;;;aAUpD;SACF;KAAA;IAEK,SAAS;;YACb,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,aAAa,CAAC,CAAC;YAEjC,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;gBACtB,IAAI,CAAC,SAAS,CAAC,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC,CAAC;aACjC;iBACI;gBACH,IAAI,CAAC,YAAY,CAAC,MAAM,EAAE,CAAC;gBAE3B,IAAI;oBACF,MAAM,IAAI,CAAC,gBAAgB,CAAC,WAAW,CACrC,gBAAgB,EAAE,EAAE,UAAU,EAAE,IAAI,CAAC,YAAY,CAAC,EAAE,EAAE,CAAC,CAAC;;;;;iBAQ3D;gBACD,OAAO,KAAK,EAAE;oBACZ,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,0BAA0B,EAAE,KAAK,CAAC,CAAC;;;;;;;;;iBAUtD;aACF;SACF;KAAA;IAGK,uBAAuB,CAAC,QAAQ;;YACpC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,2CAA2C,EAAE,QAAQ,CAAC,CAAC;;;YAKzE,IAAI;gBACF,MAAM,MAAM,GAAG,IAAI,CAAC,mBAAmB,CAAC,QAAQ,CAAC,CAAC;gBAElD,IAAI,CAAC,MAAM;oBACT,MAAM,IAAI,KAAK,CAAC,kDAAkD,CAAC,CAAC;;gBAItE,MAAM,IAAI,CAAC,yBAAyB,EAAE,CAAC;aACxC;YACD,OAAO,KAAK,EAAE;gBACZ,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,wCAAwC,EAAE,KAAK,CAAC,CAAC;aACpE;;;SAIF;KAAA;;;;IAKK,SAAS,CAAC,EACd,KAAK,GAAG,KAAK,EACb,OAAO,GAAG,KAAK,IAAI,IAAI,CAAC,OAAO,CAAC,IAAI,KAAK,SAAS,EAClD,WAAW,GAAG,IAAI,EACnB,GAAG,EAAE;;YACJ,IAAI,CAAC,MAAM,CAAC,KAAK,CACf,0DAA0D,EAC1D,KAAK,EACL,OAAO,EACP,WAAW,CACZ,CAAC;YAEF,IAAI,KAAK,CAAC;YAEV,IAAI;gBACF,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC,UAAU,CAAC,OAAO,CAAC;oBAC5C,MAAM,IAAI,KAAK,CAAC,sBAAsB,CAAC,CAAC;gBAE1C,IAAI,WAAW,IAAI,CAAC,OAAO;oBACzB,MAAM,IAAI,KAAK,CAAC,kCAAkC,CAAC,CAAC;;;;gBAOtD,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,iBAAiB,EAAE,CAAC;gBAChD,MAAM,MAAM,GAAG,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;gBAE5C,IAAI,CAAC,MAAM;oBACT,MAAM,IAAI,KAAK,CAAC,kBAAkB,CAAC,CAAC;gBAEtC,MAAM,eAAe,GAAG,KAAK,CAAC;gBAC9B,MAAM,gBAAgB,GAAG,IAAI,CAAA;gBAC7B,MAAM,gBAAgB,GAAG,IAAI,CAAA;;;;;;gBAQ7B,MAAM,EACJ,UAAU,GAAG,KAAK,EAClB,YAAY,GAAG,CAAC,EAChB,MAAM,GAAG,GAAG,EACZ,UAAU,GAAG,EAAE,EACf,UAAU,GAAG,KAAK,EAClB,OAAO,GAAG,IAAI,EACd,OAAO,GAAG,IAAI,EACd,SAAS,GAAG,EAAE,EACd,mBAAmB,GAAG,KAAK,EAC5B,GAAG,EAAE,CAAC;gBAEP,IACE,CAAC,OAAO,IAAI,IAAI,CAAC,YAAY;oBAC7B,KAAK,EACL;;oBAGA,IAAI,IAAI,CAAC,YAAY;wBACnB,MAAM,IAAI,CAAC,UAAU,EAAE,CAAC;oBAE1B,MAAM,MAAM,GAAG,MAAM,SAAS,CAAC,YAAY,CAAC,YAAY,CACtD;wBACE,KAAK,EAAE;4BACL,QAAQ,EAAE,EAAE,KAAK,EAAE,QAAQ,EAAE;4BAC7B,UAAU;4BACV,YAAY;;4BAEZ,MAAM;4BACN,eAAe;4BACf,gBAAgB;4BAChB,gBAAgB;4BAChB,UAAU;yBACX;qBACF,CACF,CAAC;oBAEF,CAAC,CAAC,KAAK,CAAC,GAAG,MAAM,CAAC,cAAc,EAAE,EAAE;oBAEpC,MAAM,EAAE,QAAQ,EAAE,aAAa,EAAE,GAAG,KAAK,CAAC,WAAW,EAAE,CAAC;;oBAIxD,IAAI,CAAC,YAAY,GAAG,MAAM,IAAI,CAAC,cAAc,CAAC,OAAO,CACnD;wBACE,KAAK;wBACL,YAAY,EACZ;4BACE,UAAU;4BACV,OAAO;4BACP,OAAO;4BACP,SAAS;4BACT,mBAAmB;yBACpB;wBACD,OAAO,EACL,EAAE,MAAM,EAAE,KAAK,EAAE;qBACpB,CAAC,CAAC;;;;;;;;;;oBAYL,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC,gBAAgB,EAAE;wBACrC,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;qBAC1B,CAAC,CAAC;oBAEH,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC,YAAY,EAAE;;;;;;;;;wBAUjC,IAAI,CAAC,UAAU,EAAE,CAAC;qBACnB,CAAC,CAAC;oBAEH,IAAI,CAAC,YAAY,CAAC,MAAM,GAAG,CAAC,CAAC;;iBAG9B;qBACI,IAAI,IAAI,CAAC,YAAY,EAAE;oBAC1B,CAAC,EAAE,KAAK,EAAE,GAAG,IAAI,CAAC,YAAY,EAAE;oBAEhC,MAAM,KAAK,CAAC,gBAAgB,CAC1B;wBACE,UAAU;wBACV,YAAY;wBACZ,MAAM;wBACN,eAAe;wBACf,gBAAgB;wBAChB,gBAAgB;wBAChB,UAAU;qBACX,CACF,CAAC;oBAEF,IAAI,IAAI,CAAC,WAAW,IAAI,IAAI,EAAE;wBAC5B,MAAM,CAAC,SAAS,CAAC,GAAG,IAAI,CAAC,WAAW,CAAC,cAAc,EAAE,CAAC;wBAEtD,SAAS,KAAI,MAAM,SAAS,CAAC,gBAAgB,CAC3C;4BACE,UAAU;4BACV,YAAY;4BACZ,MAAM;4BACN,eAAe;4BACf,gBAAgB;4BAChB,gBAAgB;4BAChB,UAAU;yBACX,CACF,CAAA,CAAC;qBACH;iBACF;gBAED,MAAM,IAAI,CAAC,mBAAmB,EAAE,CAAC;aAClC;YACD,OAAO,KAAK,EAAE;gBACZ,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,0BAA0B,EAAE,KAAK,CAAC,CAAC;;;;;;;;;gBAWrD,IAAI,KAAK;oBACP,KAAK,CAAC,IAAI,EAAE,CAAC;aAChB;;SAGF;KAAA;IAEK,YAAY,CAAC,EACjB,IAAI,GAAG,KAAK,EACZ,KAAK,GAAG,KAAK,EACb,OAAO,GAAG,KAAK,EACf,WAAW,GAAG,IAAI,EAClB,aAAa,GAAG,IAAI,EACpB,YAAY,GAAG,IAAI,EACpB,GAAG,EAAE;;YACJ,IAAI,CAAC,MAAM,CAAC,KAAK,CACf,oGAAoG,EACpG,KAAK,EACL,OAAO,EACP,WAAW,EACX,aAAa,EACb,YAAY,CACb,CAAC;YAEF,IAAI,KAAK,CAAC;YAEV,IAAI;gBACF,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC,UAAU,CAAC,OAAO,CAAC;oBAC5C,MAAM,IAAI,KAAK,CAAC,sBAAsB,CAAC,CAAC;gBAE1C,IAAI,WAAW,IAAI,CAAC,OAAO;oBACzB,MAAM,IAAI,KAAK,CAAC,kCAAkC,CAAC,CAAC;;;;;;;gBAWtD,MAAO,UAAU,GAAI,KAAK,CAAA;gBAE1B,IAAI,IAAI,IAAI,UAAU;oBACpB,OAAO;;;;gBAMT,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,kBAAkB,EAAE,CAAC;gBACjD,MAAM,MAAM,GAAG,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;gBAEvC,IAAI,CAAC,MAAM;oBACT,MAAM,IAAI,KAAK,CAAC,mBAAmB,CAAC,CAAC;gBAEvC,MAAO,UAAU,GAAG,QAAQ,CAAA;gBAC5B,MAAM,SAAS,GAAG,EAAE,CAAA;gBAIpB,IACE,CAAC,OAAO,IAAI,IAAI,CAAC,eAAe;oBAChC,KAAK,EACL;oBACA,IAAI,IAAI,CAAC,eAAe;wBACtB,MAAM,IAAI,CAAC,aAAa,EAAE,CAAC;oBAE7B,MAAM,MAAM,GAAG,MAAM,SAAS,CAAC,YAAY,CAAC,YAAY,CACtD;wBACE,KAAK,gCAEH,QAAQ,EAAE,EAAE,KAAK,EAAE,QAAQ,EAAE,IAC1B,gBAAgB,CAAC,UAAU,CAAC,KAC/B,SAAS,GACV;qBACF,CAAC,CAAC;oBAEL,CAAC,CAAC,KAAK,CAAC,GAAG,MAAM,CAAC,cAAc,EAAE,EAAE;oBAEpC,MAAM,EAAE,QAAQ,EAAE,aAAa,EAAE,GAAG,KAAK,CAAC,WAAW,EAAE,CAAC;;oBAIxD,IAAI,IAAI,CAAC,aAAa,EAAE;;wBAEtB,MAAM,eAAe,GAAG,IAAI,CAAC,gBAAgB;6BAC1C,eAAe;6BACf,MAAM;6BACN,IAAI,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,IAAI,KAAK,OAAO,CAAC,CAAC;wBAEnC,IAAI,SAAS,CAAC;wBAEd,IAAI,eAAe,CAAC,QAAQ,CAAC,WAAW,EAAE,KAAK,WAAW;4BACxD,SAAS,GAAG,oBAAoB,CAAC;6BAC9B,IAAI,kBAAkB;4BACzB,SAAS,GAAG,kBAAkB,CAAC;;4BAE/B,SAAS,GAAG,yBAAyB,CAAC;wBAExC,IAAI,CAAC,eAAe,GAAG,MAAM,IAAI,CAAC,cAAc,CAAC,OAAO,CACtD;4BACE,KAAK;4BACL,SAAS;4BACT,YAAY,EACZ;gCACE,uBAAuB,EAAE,IAAI;6BAC9B;4BACD,OAAO,EACP;gCACE,MAAM,EAAE,QAAQ;6BACjB;yBACF,CAAC,CAAC;qBACN;yBACI;wBACH,IAAI,CAAC,eAAe,GAAG,MAAM,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC;4BACvD,KAAK;4BACL,OAAO,EACP;gCACE,MAAM,EAAE,QAAQ;6BACjB;yBACF,CAAC,CAAC;qBACJ;;;;;;;;;;oBAaD,MAAM,YAAY,GAAG,IAAI,MAAM,EAAE,CAAA;oBACjC,YAAY,CAAC,WAAW,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;oBAE/C,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,YAAY,CAAC,CAAA;oBAEtC,IAAI,CAAC,eAAe,CAAC,EAAE,CAAC,gBAAgB,EAAE;wBACxC,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC;qBAC7B,CAAC,CAAC;oBAEH,IAAI,CAAC,eAAe,CAAC,EAAE,CAAC,YAAY,EAAE;;;;;;;;;wBAUpC,IAAI,CAAC,aAAa,EAAE,CAAC;qBACtB,CAAC,CAAC;iBACJ;qBACI,IAAI,IAAI,CAAC,eAAe,EAAE;oBAC7B,CAAC,EAAE,KAAK,EAAE,GAAG,IAAI,CAAC,eAAe,EAAE;oBAEnC,MAAM,KAAK,CAAC,gBAAgB,iCAErB,gBAAgB,CAAC,UAAU,CAAC,KAC/B,SAAS,IAEZ,CAAC;;oBAGF,KAAK,MAAM,QAAQ,IAAI,IAAI,CAAC,oBAAoB,CAAC,MAAM,EAAE,EAAE;wBACzD,CAAC,EAAE,KAAK,EAAE,GAAG,QAAQ,EAAE;wBAEvB,MAAM,KAAK,CAAC,gBAAgB,iCAErB,gBAAgB,CAAC,UAAU,CAAC,KAC/B,SAAS,IAEZ,CAAC;qBACH;iBACF;gBAED,MAAM,IAAI,CAAC,cAAc,EAAE,CAAC;aAC7B;YACD,OAAO,KAAK,EAAE;gBACZ,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,6BAA6B,EAAE,KAAK,CAAC,CAAC;;;;;;;;;gBAWxD,IAAI,KAAK;oBACP,KAAK,CAAC,IAAI,EAAE,CAAC;aAChB;;;SAIF;KAAA;IAEK,YAAY;;YAChB,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,gBAAgB,CAAC,CAAC;;;YAKpC,IAAI;gBACF,MAAM,IAAI,CAAC,gBAAgB,CAAC,WAAW,CAAC,wBAAwB,CAAC,CAAC;aACnE;YACD,OAAO,KAAK,EAAE;gBACZ,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,6BAA6B,EAAE,KAAK,CAAC,CAAC;aACzD;;;SAIF;KAAA;;;IAIK,kBAAkB,CAAC,MAAM,EAAE,IAAI,EAAE,IAAI;;YACzC,IAAI,CAAC,MAAM,CAAC,KAAK,CACf,+CAA+C,EAC/C,MAAM,EACN,IAAI,CACL,CAAC;;;;;;;;;;YAYF,IAAI;gBACF,KAAK,MAAM,QAAQ,IAAI,IAAI,CAAC,UAAU,CAAC,MAAM,EAAE,EAAE;oBAC/C,IAAI,QAAQ,CAAC,OAAO,CAAC,MAAM,KAAK,MAAM,IAAI,QAAQ,CAAC,OAAO,CAAC,MAAM,KAAK,IAAI,EAAE;wBAC1E,IAAI,IAAI;4BACN,MAAM,IAAI,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC;;4BAEpC,MAAM,IAAI,CAAC,eAAe,CAAC,QAAQ,CAAC,CAAC;qBACxC;iBACF;aACF;YACD,OAAO,KAAK,EAAE;gBACZ,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,mCAAmC,EAAE,KAAK,CAAC,CAAC;aAC/D;;;;;;;;;;SAWF;KAAA;IAEK,cAAc,CAAC,QAAQ;;YAC3B,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,kCAAkC,EAAE,QAAQ,CAAC,CAAC;YAEhE,IAAI,QAAQ,CAAC,MAAM,IAAI,QAAQ,CAAC,MAAM;gBACpC,OAAO;YAET,IAAI;gBACF,MAAM,IAAI,CAAC,gBAAgB,CAAC,WAAW,CAAC,eAAe,EAAE,EAAE,UAAU,EAAE,QAAQ,CAAC,EAAE,EAAE,CAAC,CAAC;gBAEtF,QAAQ,CAAC,KAAK,EAAE,CAAC;;;aAIlB;YACD,OAAO,KAAK,EAAE;gBACZ,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,+BAA+B,EAAE,KAAK,CAAC,CAAC;aAC3D;SACF;KAAA;IAEK,eAAe,CAAC,QAAQ;;YAC5B,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,mCAAmC,EAAE,QAAQ,CAAC,CAAC;YAEjE,IAAI,CAAC,QAAQ,CAAC,MAAM,IAAI,QAAQ,CAAC,MAAM;gBACrC,OAAO;YAET,IAAI;gBACF,MAAM,IAAI,CAAC,gBAAgB,CAAC,WAAW,CAAC,gBAAgB,EAAE,EAAE,UAAU,EAAE,QAAQ,CAAC,EAAE,EAAE,CAAC,CAAC;gBAEvF,QAAQ,CAAC,MAAM,EAAE,CAAC;;;aAInB;YACD,OAAO,KAAK,EAAE;gBACZ,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,gCAAgC,EAAE,KAAK,CAAC,CAAC;aAC5D;SACF;KAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IA8DK,IAAI,CAAC,EAAE,MAAM,EAAE,SAAS,EAAE,SAAS,EAAE;;YAGzC,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC;;;YAKtB,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,OAAO,CAAC,CAAA;YAChD,IAAI,CAAC,gBAAgB,CAAC,cAAc,CAAC,SAAS,CAAE;;;aAG/C,CAAC,CAAA;YACF,IAAI,CAAC,gBAAgB,CAAC,cAAc,CAAC,SAAS,CAAE;;gBAMjD,IAAI,IAAI,CAAC,eAAe,EACxB;oBACC,IAAI,CAAC,eAAe,CAAC,KAAK,EAAE,CAAC;;;oBAK7B,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC;iBAC5B;gBAED,IAAI,IAAI,CAAC,YAAY,EACrB;oBACC,IAAI,CAAC,YAAY,CAAC,KAAK,EAAE,CAAC;;;oBAK1B,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;iBACzB;gBAED,IAAI,IAAI,CAAC,cAAc,EACvB;oBACC,IAAI,CAAC,cAAc,CAAC,KAAK,EAAE,CAAC;oBAE5B,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC;iBAC3B;gBAED,IAAI,IAAI,CAAC,cAAc,EACvB;oBACC,IAAI,CAAC,cAAc,CAAC,KAAK,EAAE,CAAC;oBAE5B,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC;iBAC3B;gBAEE,IAAI,CAAC,kBAAkB,CAAC,UAAU,EAAE,CAAC;;aAItC,CAAC,CAAA;YAEF,IAAI,CAAC,gBAAgB,CAAC,aAAa,CAAC,IAAI,CAAC,SAAS,CAAC,CAAO,IAAI;gBAC5D,MAAM,EACJ,MAAM,EACN,UAAU,EACV,EAAE,EACF,IAAI,EACJ,aAAa,EACb,IAAI,EACJ,OAAO,EACP,cAAc,EACf,GAAG,IAAI,CAAC;gBAET,MAAM,QAAQ,GAAI,MAAM,IAAI,CAAC,cAAc,CAAC,OAAO,CACjD;oBACE,EAAE;oBACF,UAAU;oBACV,IAAI;oBACJ,aAAa;oBACb,OAAO,kCAAQ,OAAO,KAAE,MAAM,GAAE;iBACjC,CAAmC,CAAC;;gBAGvC,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,QAAQ,CAAC,EAAE,EAAE,QAAQ,CAAC,CAAC;gBAE3C,QAAQ,CAAC,EAAE,CAAC,gBAAgB,EAAE;oBAE5B,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;iBACrC,CAAC,CAAC;gBAKH,IAAI,CAAC,kBAAkB,CAAC,WAAW,CAAC,QAAQ,EAAG,MAAM,EAAE,IAAI,EAAE,cAAc,CAAC,CAAC;;;;;;;;;;;;;;;;;;;;;aAgC9E,CAAA,CAAC,CAAC,CAAC,SAAS,EAAE,CAAA;YAEf,IAAI,CAAC,gBAAgB,CAAC,cAAc,CAAC,IAAI,CAAC,SAAS,CAAC,CAAO,YAAY;gBACrE,IAAI,CAAC,MAAM,CAAC,KAAK,CACf,sDAAsD,EACtD,YAAY,CAAC,MAAM,EAAE,YAAY,CAAC,IAAI,CAAC,CAAC;gBAE1C,IAAI;oBACF,QAAQ,YAAY,CAAC,MAAM;wBAIzB,KAAK,eAAe;4BAClB;gCACE,MAAM,EAAE,UAAU,EAAE,KAAK,EAAE,GAAG,YAAY,CAAC,IAAI,CAAC;;;gCAKhD,MAAM;6BACP;wBAEH,KAAK,SAAS;4BACZ;gCACE,MAAM,EAAE,EAAE,EAAE,WAAW,EAAE,OAAO,EAAE,KAAK,EAAE,GAAG,YAAY,CAAC,IAAI,CAAC;;;gCAK9D,IAAI,CAAC,kBAAkB,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;;;;;;;;;;;gCAcpC,MAAM;6BACP;wBAEH,KAAK,YAAY;4BACf;gCACE,MAAM,EAAE,MAAM,EAAE,GAAG,YAAY,CAAC,IAAI,CAAC;gCAErC,IAAI,CAAC,kBAAkB,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;;;gCAK1C,MAAM;6BACP;wBAEH,KAAK,gBAAgB;4BACnB;gCACE,MAAM,EAAE,UAAU,EAAE,GAAG,YAAY,CAAC,IAAI,CAAC;gCACzC,MAAM,QAAQ,GAAG,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;gCAEjD,IAAI,CAAC,QAAQ;oCACX,MAAM;gCAER,QAAQ,CAAC,KAAK,EAAE,CAAC;gCAEjB,IAAI,QAAQ,CAAC,IAAI,IAAI,IAAI;oCACvB,QAAQ,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC;gCAEvB,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;gCAEnC,MAAM,EAAE,MAAM,EAAE,GAAG,QAAQ,CAAC,OAAO,CAAC;;;gCAKpC,MAAM;6BACP;wBAEH,KAAK,gBAAgB;4BACnB;gCACE,MAAM,EAAE,UAAU,EAAE,GAAG,YAAY,CAAC,IAAI,CAAC;gCACzC,MAAM,QAAQ,GAAG,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;gCAEjD,IAAI,CAAC,QAAQ;oCACX,MAAM;;;gCAKR,MAAM;6BACP;wBAEH,KAAK,iBAAiB;4BACpB;gCACE,MAAM,EAAE,UAAU,EAAE,GAAG,YAAY,CAAC,IAAI,CAAC;gCACzC,MAAM,QAAQ,GAAG,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;gCAEjD,IAAI,CAAC,QAAQ;oCACX,MAAM;;;gCAKR,MAAM;6BACP;wBAEH,KAAK,uBAAuB;4BAC1B;gCACE,MAAM,EAAE,UAAU,EAAE,YAAY,EAAE,aAAa,EAAE,GAAG,YAAY,CAAC,IAAI,CAAC;gCACtE,MAAM,QAAQ,GAAG,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;gCAEjD,IAAI,CAAC,QAAQ;oCACX,MAAM;gCAER,IAAI,CAAC,kBAAkB,CAAC,sBAAsB,CAAC,UAAU,CAAC,CAAA;;;gCAI1D,MAAM;6BACP;wBAEH,KAAK,eAAe;4BAClB;gCACE,MAAM,EAAE,UAAU,EAAE,KAAK,EAAE,GAAG,YAAY,CAAC,IAAI,CAAC;;;gCAKhD,MAAM;6BACP;wBACD,KAAK,UAAU;4BACb;gCACE,MAAM,IAAI,CAAC,SAAS,CAAC,EAAE,SAAS,EAAE,SAAS,EAAE,CAAC,CAAC;gCAE/C,MAAM;6BACP;wBAED,KAAK,WAAW;4BACd;gCACE,MAAM,EAAE,WAAW,EAAE,GAAG,YAAY,CAAC,IAAI,CAAC;gCAE1C,IAAI,CAAC,YAAY,GAAG,WAAW,CAAC;;;gCAKhC,MAAM,IAAI,CAAC,SAAS,CAAC,EAAE,SAAS,EAAE,SAAS,EAAE,CAAC,CAAC;gCAE/C,MAAM;6BACP;wBACP;4BACE;;;6BAGC;qBACJ;iBACF;gBACD,OAAO,KAAK,EAAE;oBACZ,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,mDAAmD,EAAE,KAAK,CAAC,CAAC;;;;;;;;;iBAU/E;aAEF,CAAA,CAAC,CAAC,CAAC,SAAS,EAAE,CAAA;;;;;;;;;;;;;;;SAwBhB;KAAA;IAGI,mBAAmB;;YAExB,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,uBAAuB,CAAC,CAAC;;YAG3C,IAAI,CAAC,aAAa,GAAG,EAAE,CAAC;YAExB,IACA;gBACC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,oDAAoD,CAAC,CAAC;gBAExE,MAAM,OAAO,GAAG,MAAM,SAAS,CAAC,YAAY,CAAC,gBAAgB,EAAE,CAAC;gBAEhE,KAAK,MAAM,MAAM,IAAI,OAAO,EAC5B;oBACC,IAAI,MAAM,CAAC,IAAI,KAAK,YAAY;wBAC/B,SAAS;oBAEV,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,QAAQ,CAAC,GAAG,MAAM,CAAC;iBAC7C;;;aAID;YACD,OAAO,KAAK,EACZ;gBACC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,oCAAoC,EAAE,KAAK,CAAC,CAAC;aAC/D;SACD;KAAA;IAEK,cAAc;;YAEnB,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,kBAAkB,CAAC,CAAC;;YAGtC,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;YAEnB,IACA;gBACC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,+CAA+C,CAAC,CAAC;gBAEnE,MAAM,OAAO,GAAG,MAAM,SAAS,CAAC,YAAY,CAAC,gBAAgB,EAAE,CAAC;gBAEhE,KAAK,MAAM,MAAM,IAAI,OAAO,EAC5B;oBACC,IAAI,MAAM,CAAC,IAAI,KAAK,YAAY;wBAC/B,SAAS;oBAEV,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,QAAQ,CAAC,GAAG,MAAM,CAAC;iBACxC;;;aAID;YACD,OAAO,KAAK,EACZ;gBACC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,+BAA+B,EAAE,KAAK,CAAC,CAAC;aAC1D;SACD;KAAA;IAEK,aAAa;;YAElB,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,iBAAiB,CAAC,CAAC;YAErC,IAAI,CAAC,IAAI,CAAC,eAAe;gBACxB,OAAO;;YAIR,IAAI,CAAC,eAAe,CAAC,KAAK,EAAE,CAAC;;;YAK7B,IACA;gBACC,MAAM,IAAI,CAAC,gBAAgB,CAAC,WAAW,CACtC,eAAe,EAAE,EAAE,UAAU,EAAE,IAAI,CAAC,eAAe,CAAC,EAAE,EAAE,CAAC,CAAC;aAC3D;YACD,OAAO,KAAK,EACZ;gBACC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,8BAA8B,EAAE,KAAK,CAAC,CAAC;aACzD;YAED,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC;;;SAG5B;KAAA;IACK,UAAU;;YAEf,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,cAAc,CAAC,CAAC;YAElC,IAAI,CAAC,IAAI,CAAC,YAAY;gBACrB,OAAO;;YAIR,IAAI,CAAC,YAAY,CAAC,KAAK,EAAE,CAAC;;;YAK1B,IACA;gBACC,MAAM,IAAI,CAAC,gBAAgB,CAAC,WAAW,CACtC,eAAe,EAAE,EAAE,UAAU,EAAE,IAAI,CAAC,YAAY,CAAC,EAAE,EAAE,CAAC,CAAC;aACxD;YACD,OAAO,KAAK,EACZ;gBACC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,2BAA2B,EAAE,KAAK,CAAC,CAAC;aACtD;YAED,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;;SAGxB;KAAA;IAGI,kBAAkB;;YAEvB,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,sBAAsB,CAAC,CAAC;YAE1C,IACA;gBACC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,iDAAiD,CAAC,CAAC;gBAErE,MAAM,IAAI,CAAC,cAAc,EAAE,CAAC;gBAE5B,MAAO,cAAc,GAAI,IAAI,CAAA;gBAE7B,IAAI,cAAc,IAAI,IAAI,CAAC,QAAQ,CAAC,cAAc,CAAC;oBAClD,OAAO,cAAc,CAAC;qBAEvB;oBACC,MAAM,OAAO,GAAG,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;;oBAG7C,OAAO,OAAO,CAAC,CAAC,CAAC,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC,QAAQ,GAAG,IAAI,CAAC;iBAC/C;aACD;YACD,OAAO,KAAK,EACZ;gBACC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,mCAAmC,EAAE,KAAK,CAAC,CAAC;aAC9D;SACA;KAAA;IAGI,iBAAiB;;YAEtB,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,qBAAqB,CAAC,CAAC;YAEzC,IACA;gBACC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,sDAAsD,CAAC,CAAC;gBAE1E,MAAM,IAAI,CAAC,mBAAmB,EAAE,CAAC;gBAE9B,MAAO,mBAAmB,GAAG,IAAI,CAAC;gBAErC,IAAI,mBAAmB,IAAI,IAAI,CAAC,aAAa,CAAC,mBAAmB,CAAC;oBACjE,OAAO,mBAAmB,CAAC;qBAE5B;oBACC,MAAM,YAAY,GAAG,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;;oBAGvD,OAAO,YAAY,CAAC,CAAC,CAAC,GAAG,YAAY,CAAC,CAAC,CAAC,CAAC,QAAQ,GAAG,IAAI,CAAC;iBACzD;aACD;YACD,OAAO,KAAK,EACZ;gBACC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,kCAAkC,EAAE,KAAK,CAAC,CAAC;aAC7D;SACD;KAAA;IAEK,yBAAyB;;YAE9B,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,6BAA6B,CAAC,CAAC;;YAGjD,IAAI,CAAC,mBAAmB,GAAG,EAAE,CAAC;YAE9B,IACA;gBACC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,0DAA0D,CAAC,CAAC;gBAE9E,MAAM,OAAO,GAAG,MAAM,SAAS,CAAC,YAAY,CAAC,gBAAgB,EAAE,CAAC;gBAEhE,KAAK,MAAM,MAAM,IAAI,OAAO,EAC5B;oBACC,IAAI,MAAM,CAAC,IAAI,KAAK,aAAa;wBAChC,SAAS;oBAEV,IAAI,CAAC,mBAAmB,CAAC,MAAM,CAAC,QAAQ,CAAC,GAAG,MAAM,CAAC;iBACnD;;;aAID;YACD,OAAO,KAAK,EACZ;gBACC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,0CAA0C,EAAE,KAAK,CAAC,CAAC;aACrE;SACD;KAAA;IAIM,SAAS,CAAC,EAAE,SAAS,EAAE,SAAS,EAAE;;YACtC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,aAAa,CAAC,CAAC;YAEjC,MAAM,WAAW,GAAG,SAAS,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,MAAM,GAAG,KAAK,CAAC,CAAC,GAAG,KAAK,EAAE,CAAA;YAGnF,IAAI;gBAGF,IAAI,CAAC,gBAAgB,GAAG,IAAIC,MAAsB,EAAE,CAAC;gBAErD,MAAM,qBAAqB,GACzB,MAAM,IAAI,CAAC,gBAAgB,CAAC,WAAW,CAAC,0BAA0B,CAAC,CAAC;gBAEtE,qBAAqB,CAAC,gBAAgB,GAAG,qBAAqB,CAAC,gBAAgB;qBAC5E,MAAM,CAAC,CAAC,GAAG,KAAK,GAAG,CAAC,GAAG,KAAK,4BAA4B,CAAC,CAAC;gBAE7D,MAAM,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,EAAE,qBAAqB,EAAE,CAAC,CAAC;gBAE5D,IAAI,IAAI,CAAC,QAAQ,EAAE;oBACjB,MAAM,aAAa,GAAG,MAAM,IAAI,CAAC,gBAAgB,CAAC,WAAW,CAC3D,uBAAuB,EACvB;wBACE,QAAQ,EAAE,IAAI,CAAC,SAAS;wBACxB,SAAS,EAAE,IAAI;wBACf,SAAS,EAAE,KAAK;qBACjB,CAAC,CAAC;oBAEL,MAAM,EACJ,EAAE,EACF,aAAa,EACb,aAAa,EACb,cAAc,EACf,GAAG,aAAa,CAAC;oBAElB,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,gBAAgB,CAAC,mBAAmB,CAC7D;wBACE,EAAE;wBACF,aAAa;wBACb,aAAa;wBACb,cAAc;wBACd,UAAU,EAAE,IAAI,CAAC,YAAY;;wBAE7B,kBAAkB,EAAE,IAAI,CAAC,OAAO,CAAC,IAAI,KAAK,SAAS,IAAI,IAAI,CAAC,YAAY,GAAG,OAAO,GAAG,SAAS;wBAC9F,sBAAsB,EAAE,0BAA0B;qBACnD,CAAC,CAAC;oBAEL,IAAI,CAAC,cAAc,CAAC,EAAE,CACpB,SAAS,EAAE,CAAC,EAAE,cAAc,EAAE,EAAE,QAAQ,EAAE,OAAO;;wBAEjD,IAAI,CAAC,gBAAgB,CAAC,WAAW,CAC/B,wBAAwB,EACxB;4BACE,WAAW,EAAE,IAAI,CAAC,cAAc,CAAC,EAAE;4BACnC,cAAc;yBACf,CAAC;6BACD,IAAI,CAAC,QAAQ,CAAC;6BACd,KAAK,CAAC,OAAO,CAAC,CAAC;qBACnB,CAAC,CAAC;oBAEH,IAAI,CAAC,cAAc,CAAC,EAAE,CACpB,SAAS,EAAE,CAAO,EAAE,IAAI,EAAE,aAAa,EAAE,OAAO,EAAE,EAAE,QAAQ,EAAE,OAAO;wBACrE,IAAI;;4BAEF,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM,IAAI,CAAC,gBAAgB,CAAC,WAAW,CACpD,SAAS,EACT;gCACE,WAAW,EAAE,IAAI,CAAC,cAAc,CAAC,EAAE;gCACnC,IAAI;gCACJ,aAAa;gCACb,OAAO;6BACR,CAAC,CAAC;4BAEL,QAAQ,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;yBAClB;wBACD,OAAO,KAAK,EAAE;4BACZ,OAAO,CAAC,KAAK,CAAC,CAAC;yBAChB;qBACF,CAAA,CAAC,CAAC;iBACJ;gBAED,MAAM,aAAa,GAAG,MAAM,IAAI,CAAC,gBAAgB,CAAC,WAAW,CAC3D,uBAAuB,EACvB;oBACE,QAAQ,EAAE,IAAI,CAAC,SAAS;oBACxB,SAAS,EAAE,KAAK;oBAChB,SAAS,EAAE,IAAI;iBAChB,CAAC,CAAC;gBAEL,MAAM,EACJ,EAAE,EACF,aAAa,EACb,aAAa,EACb,cAAc,EACf,GAAG,aAAa,CAAC;gBAElB,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,gBAAgB,CAAC,mBAAmB,CAC7D;oBACE,EAAE;oBACF,aAAa;oBACb,aAAa;oBACb,cAAc;oBACd,UAAU,EAAE,IAAI,CAAC,YAAY;;oBAE7B,kBAAkB,EAAE,IAAI,CAAC,OAAO,CAAC,IAAI,KAAK,SAAS,IAAI,IAAI,CAAC,YAAY,GAAG,OAAO,GAAG,SAAS;iBAC/F,CAAC,CAAC;gBAEL,IAAI,CAAC,cAAc,CAAC,EAAE,CACpB,SAAS,EAAE,CAAC,EAAE,cAAc,EAAE,EAAE,QAAQ,EAAE,OAAO;;oBAEjD,IAAI,CAAC,gBAAgB,CAAC,WAAW,CAC/B,wBAAwB,EACxB;wBACE,WAAW,EAAE,IAAI,CAAC,cAAc,CAAC,EAAE;wBACnC,cAAc;qBACf,CAAC;yBACD,IAAI,CAAC,QAAQ,CAAC;yBACd,KAAK,CAAC,OAAO,CAAC,CAAC;iBACnB,CAAC,CAAC;;;;;;;;;;gBAYH,MAAM,EACJ,aAAa,EACb,KAAK,EACL,KAAK,EACL,OAAO,EACP,eAAe,EACf,SAAS,EACT,oBAAoB,EACpB,WAAW,EACX,WAAW,EACX,YAAY,EACZ,MAAM,EACN,UAAU,EACV,UAAU,EACX,GAAG,MAAM,IAAI,CAAC,gBAAgB,CAAC,WAAW,CACzC,MAAM,EACN;oBACE,WAAW,EAAE,WAAW;oBAExB,eAAe,EAAE,IAAI,CAAC,gBAAgB,CAAC,eAAe;iBACvD,CAAC,CAAC;gBAEL,IAAI,CAAC,MAAM,CAAC,KAAK,CACf,iFAAiF,EACjF,aAAa,EACb,KAAK,EACL,KAAK,EACL,SAAS,CACV,CAAC;;;;;;gBAYA,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,YAAY,EAAC,SAAS,EAAG,mBAAmB,EAC5D,IAAI,CAAC,gBAAgB,CAAC,UAAU,CAAC,OAAO,CAAC,EAAE,cAAc,EAAE,IAAI,CAAC,MAAM,CAAC,CAAA;;gBAE3E,IAAI,IAAI,CAAC,QAAQ,EAAE;oBACjB,IACE,SAAS,EACT;wBACA,IAAI,CAAC,YAAY,CAAC,EAAE,IAAI,EAAE,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC,CAAC;qBAChD;oBACD,IACE,SAAS;wBACT,IAAI,CAAC,gBAAgB,CAAC,UAAU,CAAC,OAAO,CAAC;wBAEzC,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE;4BAChB,MAAM,IAAI,CAAC,SAAS,CAAC,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC,CAAC;yBAEvC;iBACJ;gBAED,MAAM,IAAI,CAAC,yBAAyB,EAAE,CAAC;;;;;;;;;;;;;;;;;;;;gBA0BvC,IAAI,CAAC,kBAAkB,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;aAGzC;YACD,OAAO,KAAK,EAAE;gBACZ,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,0BAA0B,EAAE,KAAK,CAAC,CAAC;gBAGrD,IAAI,CAAC,KAAK,EAAE,CAAC;aACd;SACF;KAAA;IACD,UAAU;QACR,MAAM,EAAE,GAAG,SAAS,CAAC,SAAS,CAAC;QAC/B,MAAM,OAAO,GAAG,MAAM,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC;QAErC,IAAI,IAAI,CAAC;QAET,IAAI,OAAO,CAAC,SAAS,CAAC,EAAE,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC;YACvD,IAAI,GAAG,QAAQ,CAAC;aACb,IAAI,OAAO,CAAC,SAAS,CAAC,EAAE,OAAO,EAAE,KAAK,EAAE,CAAC;YAC5C,IAAI,GAAG,SAAS,CAAC;aACd,IAAI,OAAO,CAAC,SAAS,CAAC,EAAE,MAAM,EAAE,KAAK,EAAE,CAAC;YAC3C,IAAI,GAAG,QAAQ,CAAC;aACb,IAAI,OAAO,CAAC,SAAS,CAAC,EAAE,KAAK,EAAE,KAAK,EAAE,CAAC;YAC1C,IAAI,GAAG,OAAO,CAAC;aACZ,IAAI,OAAO,CAAC,SAAS,CAAC,EAAE,gBAAgB,EAAE,KAAK,EAAE,CAAC;YACrD,IAAI,GAAG,MAAM,CAAC;;YAEd,IAAI,GAAG,SAAS,CAAC;QAEnB,OAAO;YACL,IAAI;YACJ,EAAE,EAAE,OAAO,CAAC,SAAS,CAAC,IAAI,CAAC;YAC3B,QAAQ,EAAE,OAAO,CAAC,eAAe,CAAC,IAAI,CAAC;YACvC,IAAI,EAAE,OAAO,CAAC,cAAc,CAAC,IAAI,CAAC;YAClC,OAAO,EAAE,OAAO,CAAC,iBAAiB,EAAE;YACpC,MAAM,EAAE,OAAO;SAChB,CAAC;KAEH;;sEAzqDW,WAAW;gDAAX,WAAW,WAAX,WAAW,mBAFX,MAAM;+CAEN,WAAW;cAHxB,UAAU;eAAC;gBACV,UAAU,EAAE,MAAM;aACnB;;;ACpFD;;;;ACAA;;;;;;"}