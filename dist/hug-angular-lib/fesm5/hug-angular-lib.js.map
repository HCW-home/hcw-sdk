{"version":3,"file":"hug-angular-lib.js","sources":["ng://hug-angular-lib/lib/hug-angular-lib.component.ts","ng://hug-angular-lib/lib/log.service.ts","ng://hug-angular-lib/lib/hug-angular-lib.module.ts","ng://hug-angular-lib/lib/stream.ts","ng://hug-angular-lib/lib/signaling.service.ts","ng://hug-angular-lib/lib/peer.ts","ng://hug-angular-lib/lib/remote-peers.service.ts","ng://hug-angular-lib/lib/room.service.ts","ng://hug-angular-lib/public-api.ts","ng://hug-angular-lib/hug-angular-lib.ts"],"sourcesContent":["import { Component, OnInit } from '@angular/core';\n\n@Component({\n  selector: 'lib-hug-angular-lib',\n  template: `\n    <p>\n      hug-fuck shit address\n    </p>\n  `,\n  styles: []\n})\nexport class HugAngularLibComponent implements OnInit {\n\n  constructor() { }\n\n  ngOnInit(): void {\n\n  }\n\n}\n","// import { Injectable } from '@angular/core';\nexport { NGXLogger as LogService } from 'ngx-logger';\n\n// @Injectable({\n//   providedIn: 'root'\n// })\n// export class LogService extends NGXLogger {\n\n//   constructor() {\n//     super()\n//   }\n// }\n","import { LogService } from './log.service';\nimport { NgModule } from '@angular/core';\nimport { HugAngularLibComponent } from './hug-angular-lib.component';\nimport { LoggerModule, NgxLoggerLevel } from 'ngx-logger';\n\nconsole.log('NGX logger')\n@NgModule({\n  declarations: [HugAngularLibComponent],\n  imports: [\n    LoggerModule.forRoot({ level: NgxLoggerLevel.DEBUG})\n  ],\n  providers:[LogService],\n  exports: [HugAngularLibComponent]\n})\nexport class HugAngularLibModule { }\n","import { Subject } from 'rxjs';\n\n\nimport * as mediasoup from 'mediasoup-client';\n\nimport { Peer } from './peer';\n\n\nexport class Stream {\n\n  public consumer?: mediasoup.types.Consumer;\n  public peer?: Peer;\n  public producer?\n  public streamId: string;\n\n  public onLayerChange: Subject<any> = new Subject()\n\n  public type;\n  public producerPaused: boolean\n\n  public kind;\n\n  mediaStream: MediaStream = new MediaStream();\n\n  setConsumer(consumer: mediasoup.types.Consumer) {\n    this.consumer = consumer;\n    this.streamId = consumer.id\n    this.kind = consumer.kind;\n    this.mediaStream.addTrack(consumer.track);\n  }\n\n  consumerLayerChanged() {\n    this.mediaStream = new MediaStream();\n    this.mediaStream.addTrack(this.consumer.track);\n    this.onLayerChange.next()\n  }\n\n\n  setProducer(producer) {\n    this.producer = producer\n    this.mediaStream.addTrack(producer.track);\n  }\n}\n","import { LogService } from './log.service';\nimport { Injectable } from '@angular/core';\n\n\nimport { io, Socket } from 'socket.io-client';\nimport { Subject } from 'rxjs';\n\n\nconst requestTimeout = 20000\n\n/**\n * Error produced when a socket request has a timeout.\n */\nexport class SocketTimeoutError extends Error\n{\n\tconstructor(message)\n\t{\n\t\tsuper(message);\n\n\t\tthis.name = 'SocketTimeoutError';\n\n    if (Error.hasOwnProperty('captureStackTrace')) // Just in V8.\n      // @ts-ignore\n\t\t\tError.captureStackTrace(this, SocketTimeoutError);\n\t\telse\n\t\t\tthis.stack = (new Error(message)).stack;\n\t}\n}\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class SignalingService  {\n\n  peerId: string;\n  roomId: string;\n  _signalingSocket: Socket;\n  _signalingUrl: string;\n  _closed = false;\n\n  onDisconnected: Subject<any> = new Subject()\n  onReconnecting: Subject<any> = new Subject()\n  onReconnected: Subject<any> = new Subject()\n  onNewConsumer: Subject<any> = new Subject();\n  onNotification: Subject<any> = new Subject();\n  constructor(private logger: LogService ) {\n\n   }\n\n\n  init(token) {\n\n    this._closed = false;\n    this._signalingUrl;\n    this._signalingSocket = io(token)\n    this.logger.debug(\"Initialize socket \", this._signalingUrl)\n\n\n\t\tthis._signalingSocket.on('connect', () =>\n\t\t{\n\t\t \tthis.logger.debug('signaling Peer \"connect\" event');\n    });\n\n    this._signalingSocket.on('disconnect', (reason) =>\n\t\t{\n\t\t\tthis.logger.warn('signaling Peer \"disconnect\" event [reason:\"%s\"]', reason);\n\n\t\t\tif (this._closed)\n\t\t\t\treturn;\n\n\t\t\tif (reason === 'io server disconnect')\n\t\t\t{\n        this.onDisconnected.next()\n\n\t\t\t\tthis.close();\n\t\t\t}\n\n      this.onReconnecting.next\n\n\t\t});\n\n    this._signalingSocket.on('reconnect_failed', () =>\n\t\t{\n\t\t\tthis.logger.warn('signaling Peer \"reconnect_failed\" event');\n\n      this.onDisconnected.next()\n\n\t\t\tthis.close();\n    });\n\n\n\t\tthis._signalingSocket.on('reconnect', (attemptNumber) =>\n\t\t{\n\t\t\tthis.logger.debug('signaling Peer \"reconnect\" event [attempts:\"%s\"]', attemptNumber);\n\n      this.onReconnected.next(attemptNumber)\n\n\n\t\t\t// store.dispatch(roomActions.setRoomState('connected'));\n\t\t});\n\n\n\n\t\tthis._signalingSocket.on('request', async (request, cb) =>\n\t\t{\n\t\t\tthis.logger.debug(\n\t\t\t\t'socket \"request\" event [method:\"%s\", data:\"%o\"]',\n\t\t\t\trequest.method, request.data);\n\n\n\t\t\tswitch (request.method)\n\t\t\t{\n\t\t\t\tcase 'newConsumer':\n\t\t\t\t{\n            this.onNewConsumer.next(request.data);\n            cb()\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tdefault:\n\t\t\t\t{\n\t\t\t\t\tthis.logger.error('unknown request.method \"%s\"', request.method);\n\n\t\t\t\t\tcb(500, `unknown request.method \"${request.method}\"`);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n    this._signalingSocket.on('notification', (notification) => {\n      this.logger.debug(\n        'socket> \"notification\" event [method:\"%s\", data:\"%o\"]',\n        notification.method, notification.data);\n\n      this.onNotification.next(notification)\n\n    });\n\n\n\n  }\n  close() {\n    if (this._closed)\n      return;\n\n    this._closed = true;\n\n    this.logger.debug('close()');\n\n    this._signalingSocket.close();\n    this._signalingSocket = null;\n\n\n  }\n\ttimeoutCallback(callback)\n\t{\n\t\tlet called = false;\n\n\t\tconst interval = setTimeout(\n\t\t\t() =>\n\t\t\t{\n\t\t\t\tif (called)\n\t\t\t\t\treturn;\n\t\t\t\tcalled = true;\n\t\t\t\tcallback(new SocketTimeoutError('Request timed out'));\n\t\t\t},\n\t\t\trequestTimeout\n\t\t);\n\n\t\treturn (...args) =>\n\t\t{\n\t\t\tif (called)\n\t\t\t\treturn;\n\t\t\tcalled = true;\n\t\t\tclearTimeout(interval);\n\n\t\t\tcallback(...args);\n\t\t};\n\t}\n\n\t_sendRequest(method, data)\n\t{\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tif (!this._signalingSocket)\n\t\t\t{\n\t\t\t\treject('No socket connection');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis._signalingSocket.emit(\n\t\t\t\t\t'request',\n\t\t\t\t\t{ method, data },\n\t\t\t\t\tthis.timeoutCallback((err, response) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tif (err)\n\t\t\t\t\t\t\treject(err);\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tresolve(response);\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t}\n\t\t});\n  }\n\n\n\tpublic async sendRequest(method, data?):Promise<any>\n\t{\n\t\tthis.logger.debug('sendRequest() [method:\"%s\", data:\"%o\"]', method, data);\n\n\t\tconst requestRetries = 3\n\n\n\t\tfor (let tries = 0; tries < requestRetries; tries++)\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\treturn await this._sendRequest(method, data);\n\t\t\t}\n\t\t\tcatch (error)\n\t\t\t{\n\t\t\t\tif (\n\t\t\t\t\terror instanceof SocketTimeoutError &&\n\t\t\t\t\ttries < requestRetries\n\t\t\t\t)\n\t\t\t\t\tthis.logger.warn('sendRequest() | timeout, retrying [attempt:\"%s\"]', tries);\n\t\t\t\telse\n\t\t\t\t\tthrow error;\n\t\t\t}\n\t\t}\n\t}\n\n}\n","import { Stream } from './stream';\nexport class Peer {\n  id: string\n  streams: Stream[]=[]\n}\n","import { Stream } from './stream';\nimport { LogService } from './log.service';\nimport { Peer } from './peer';\nimport { Observable } from 'rxjs/internal/Observable';\nimport { Injectable } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\nimport * as mediasoup from 'mediasoup-client';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class RemotePeersService {\n\n\tpublic remotePeers: Observable<Peer[]>;\n\tprivate _remotePeers: BehaviorSubject<Peer[]> = new BehaviorSubject([]);\n\n  private peers: Peer[] = []\n  constructor(private logger: LogService) {\n    this.remotePeers = this._remotePeers.asObservable()\n   }\n\n\n  updatePeers() {\n    setTimeout(() => \tthis._remotePeers.next(this.peers)    ,0)\n  }\n\n  clearPeers(){\n    this._remotePeers = <BehaviorSubject<Peer[]>>new BehaviorSubject([]);\n    this.remotePeers = this._remotePeers.asObservable();\n    this.peers = []\n  }\n  newPeer(id): Peer {\n    this.logger.debug('New peer', id)\n    const peer = new Peer()\n    peer.id = id;\n    peer.streams = []\n    this.addPeer(peer)\n    this.updatePeers()\n    return peer\n  }\n  closePeer(id){\n\t\tthis.logger.debug(\n\t\t\t'room \"peerClosed\" event [peerId:%o]', id);\n\n    this.peers = this.peers.filter((peer) => peer.id !== id);\n    this.updatePeers()\n  }\n\n\n  addPeer(peer: Peer) {\n    this.peers.push(peer)\n  }\n\n  addPeers(peers){\n    this.logger.debug('Add peers ', peers)\n\t\tfor (const peer of peers)\n\t\t{\n\t\t\tif (!this.peers.find(p=>peer.id === p.id))\n\t\t\t{\n\t\t\t\tthis.logger.debug('adding peer [peerId: \"%s\"]', peer.id);\n        this.peers.push({ id: peer.id, streams:[] });\n\t\t\t}\n\t\t}\n\t\tthis.updatePeers();\n  }\n\n  newConsumer(consumer: mediasoup.types.Consumer, peerId: string, type, producerPaused) {\n\n    this.logger.debug('remote peers New consumer', consumer, peerId)\n    let peer = this.peers.find(peer => peer.id === peerId)\n\n    if (!peer) {\n      this.logger.warn('Couldn\\'t find peer', peerId, this.peers)\n      peer = this.newPeer(peerId)\n    }\n    const existingStream = peer.streams.find(stream => stream.consumer?.appData.source === consumer.appData.source)\n\n    if (existingStream) {\n      existingStream.setConsumer(consumer)\n    } else {\n      const stream = new Stream()\n      stream.peer = peer\n      stream.type = type;\n      stream.producerPaused = producerPaused;\n      stream.setConsumer(consumer)\n      this.logger.debug('New stream created ', stream)\n      peer.streams.push(stream)\n    }\n\n    this.updatePeers()\n\n  }\n\n  onConsumerLayerChanged(consumerId) {\n\n\n\n      const stream = this.getStreamByConsumerId( consumerId)\n      if (stream) {\n\n        stream.consumerLayerChanged()\n      }\n\n  }\n\n\n  getStreamByConsumerId(consumerId: string): Stream {\n    for (const peer of this.peers) {\n      const stream = peer.streams.find(s => s.consumer.id === consumerId)\n      if (stream) {\n        return stream\n      }\n    }\n    return null\n  }\n}\n","import { Stream } from './stream';\nimport { RemotePeersService } from './remote-peers.service';\nimport { LogService } from './log.service';\nimport { SignalingService } from './signaling.service';\n\nimport { Injectable } from '@angular/core';\n\nimport { switchMap } from 'rxjs/operators';\nimport bowser from 'bowser';\n\nimport * as mediasoupClient from 'mediasoup-client'\nimport { Subject } from 'rxjs';\nimport hark from 'hark';\n\n\nlet saveAs;\n\n\nconst lastN = 4\nconst mobileLastN = 1\nconst videoAspectRatio = 1.777\n\nconst simulcast = true;\nconst \tsimulcastEncodings   = [\n  { scaleResolutionDownBy: 4 },\n  { scaleResolutionDownBy: 2 },\n  { scaleResolutionDownBy: 1 }\n]\n\n\nconst VIDEO_CONSTRAINS =\n{\n\t'low' :\n\t{\n\t\twidth       : { ideal: 320 },\n\t\taspectRatio : videoAspectRatio\n\t},\n\t'medium' :\n\t{\n\t\twidth       : { ideal: 640 },\n\t\taspectRatio : videoAspectRatio\n\t},\n\t'high' :\n\t{\n\t\twidth       : { ideal: 1280 },\n\t\taspectRatio : videoAspectRatio\n\t},\n\t'veryhigh' :\n\t{\n\t\twidth       : { ideal: 1920 },\n\t\taspectRatio : videoAspectRatio\n\t},\n\t'ultra' :\n\t{\n\t\twidth       : { ideal: 3840 },\n\t\taspectRatio : videoAspectRatio\n\t}\n};\n\nconst PC_PROPRIETARY_CONSTRAINTS =\n{\n\toptional : [ { googDscp: true } ]\n};\n\nconst VIDEO_SIMULCAST_ENCODINGS =\n[\n\t{ scaleResolutionDownBy: 4, maxBitRate: 100000 },\n\t{ scaleResolutionDownBy: 1, maxBitRate: 1200000 }\n];\n\n// Used for VP9 webcam video.\nconst VIDEO_KSVC_ENCODINGS =\n[\n\t{ scalabilityMode: 'S3T3_KEY' }\n];\n\n// Used for VP9 desktop sharing.\nconst VIDEO_SVC_ENCODINGS =\n[\n\t{ scalabilityMode: 'S3T3', dtx: true }\n];\n\n\n@Injectable({\n  providedIn: 'root'\n})\nexport  class RoomService {\n\n\n\n  // Transport for sending.\n  _sendTransport = null;\n  // Transport for receiving.\n  _recvTransport = null;\n\n  _closed = false;\n\n  _produce = true;\n\n  _forceTcp = false;\n\n  _muted\n  _device\n  _peerId\n  _soundAlert\n  _roomId\n  _mediasoupDevice\n\n  _micProducer\n  _hark\n  _harkStream\n  _webcamProducer\n  _extraVideoProducers\n  _webcams\n  _audioDevices\n  _audioOutputDevices\n  _consumers\n  _useSimulcast\n  _turnServers\n\n  subscriptions = [];\n  public onCamProducing: Subject<any> = new Subject();\n  public onVolumeChange: Subject<any> = new Subject();\n  constructor(\n    private signalingService: SignalingService,\n    private logger: LogService,\n  private remotePeersService: RemotePeersService) {\n\n\n  }\n\n  init({\n    peerId=null,\n\n    produce=true,\n    forceTcp=false,\n    muted=false\n  } = {}) {\n    if (!peerId)\n      throw new Error('Missing peerId');\n\n\n    // logger.debug(\n    //   'constructor() [peerId: \"%s\", device: \"%s\", produce: \"%s\", forceTcp: \"%s\", displayName \"\"]',\n    //   peerId, device.flag, produce, forceTcp);\n\n\n\n    this.logger.debug('INIT Room ', peerId)\n\n    this._closed = false;\n    // Whether we should produce.\n    this._produce = produce;\n\n    // Whether we force TCP\n    this._forceTcp = forceTcp;\n\n\n\n\n    // Whether simulcast should be used.\n    // this._useSimulcast = false;\n\n    // if ('simulcast' in window.config)\n    //   this._useSimulcast = window.config.simulcast;\n\n\n\n\n\n    this._muted = muted;\n\n    // This device\n    this._device = this.deviceInfo();\n\n    // My peer name.\n    this._peerId = peerId;\n\n\n\n    // Alert sound\n    // this._soundAlert = new Audio('/sounds/notify.mp3');\n\n\n\n\n    // The room ID\n    this._roomId = null;\n\n    // mediasoup-client Device instance.\n    // @type {mediasoupClient.Device}\n    this._mediasoupDevice = null;\n\n\n    // Transport for sending.\n    this._sendTransport = null;\n\n    // Transport for receiving.\n    this._recvTransport = null;\n\n    // Local mic mediasoup Producer.\n    this._micProducer = null;\n\n    // Local mic hark\n    this._hark = null;\n\n    // Local MediaStream for hark\n    this._harkStream = null;\n\n    // Local webcam mediasoup Producer.\n    this._webcamProducer = null;\n\n    // Extra videos being produced\n    this._extraVideoProducers = new Map();\n\n    // Map of webcam MediaDeviceInfos indexed by deviceId.\n    // @type {Map<String, MediaDeviceInfos>}\n    this._webcams = {};\n\n    this._audioDevices = {};\n\n    this._audioOutputDevices = {};\n\n    // mediasoup Consumers.\n    // @type {Map<String, mediasoupClient.Consumer>}\n    this._consumers = new Map();\n\n    this._useSimulcast = simulcast\n\n    // this._startKeyListener();\n\n    // this._startDevicesListener();\n\n  }\n  close() {\n    this.logger.debug('close()', this._closed);\n\n    if (this._closed)\n      return;\n\n    this._closed = true;\n\n    this.logger.debug('close()');\n\n    this.signalingService.close();\n\n    // Close mediasoup Transports.\n    if (this._sendTransport)\n      this._sendTransport.close();\n\n    if (this._recvTransport)\n      this._recvTransport.close();\n\n    this.subscriptions.forEach(subscription => {\n      subscription.unsubscribe()\n    })\n\n    this.disconnectLocalHark()\n    this.remotePeersService.clearPeers()\n  }\n\n  // _startKeyListener() {\n  //   // Add keydown event listener on document\n  //   document.addEventListener('keydown', (event) => {\n  //     if (event.repeat) return;\n  //     const key = String.fromCharCode(event.which);\n\n  //     const source = event.target;\n\n  //     const exclude = ['input', 'textarea'];\n\n  //     if (exclude.indexOf(source.tagName.toLowerCase()) === -1) {\n  //       logger.debug('keyDown() [key:\"%s\"]', key);\n\n  //       switch (key) {\n\n  //         /*\n  //         case String.fromCharCode(37):\n  //         {\n  //           const newPeerId = this._spotlights.getPrevAsSelected(\n  //             store.getState().room.selectedPeerId);\n\n  //           if (newPeerId) this.setSelectedPeer(newPeerId);\n  //           break;\n  //         }\n\n  //         case String.fromCharCode(39):\n  //         {\n  //           const newPeerId = this._spotlights.getNextAsSelected(\n  //             store.getState().room.selectedPeerId);\n\n  //           if (newPeerId) this.setSelectedPeer(newPeerId);\n  //           break;\n  //         }\n  //         */\n\n\n  //         case 'M': // Toggle microphone\n  //           {\n  //             if (this._micProducer) {\n  //               if (!this._micProducer.paused) {\n  //                 this.muteMic();\n\n  //                 store.dispatch(requestActions.notify(\n  //                   {\n  //                     text: intl.formatMessage({\n  //                       id: 'devices.microphoneMute',\n  //                       defaultMessage: 'Muted your microphone'\n  //                     })\n  //                   }));\n  //               }\n  //               else {\n  //                 this.unmuteMic();\n\n  //                 store.dispatch(requestActions.notify(\n  //                   {\n  //                     text: intl.formatMessage({\n  //                       id: 'devices.microphoneUnMute',\n  //                       defaultMessage: 'Unmuted your microphone'\n  //                     })\n  //                   }));\n  //               }\n  //             }\n  //             else {\n  //               this.updateMic({ start: true });\n\n  //               store.dispatch(requestActions.notify(\n  //                 {\n  //                   text: intl.formatMessage({\n  //                     id: 'devices.microphoneEnable',\n  //                     defaultMessage: 'Enabled your microphone'\n  //                   })\n  //                 }));\n  //             }\n\n  //             break;\n  //           }\n\n  //         case 'V': // Toggle video\n  //           {\n  //             if (this._webcamProducer)\n  //               this.disableWebcam();\n  //             else\n  //               this.updateWebcam({ start: true });\n\n  //             break;\n  //           }\n\n  //         case 'H': // Open help dialog\n  //           {\n  //             store.dispatch(roomActions.setHelpOpen(true));\n\n  //             break;\n  //           }\n\n  //         default:\n  //           {\n  //             break;\n  //           }\n  //       }\n  //     }\n  //   });\n\n\n  // }\n\n  _startDevicesListener() {\n    navigator.mediaDevices.addEventListener('devicechange', async () => {\n      this.logger.debug('_startDevicesListener() | navigator.mediaDevices.ondevicechange');\n\n      await this._updateAudioDevices();\n      await this._updateWebcams();\n      await this._updateAudioOutputDevices();\n\n      // store.dispatch(requestActions.notify(\n      //   {\n      //     text: intl.formatMessage({\n      //       id: 'devices.devicesChanged',\n      //       defaultMessage: 'Your devices changed, configure your devices in the settings dialog'\n      //     })\n      //   }));\n    });\n  }\n\n\n\n  async muteMic() {\n    this.logger.debug('muteMic()');\n\n    this._micProducer.pause();\n\n    try {\n      await this.signalingService.sendRequest(\n        'pauseProducer', { producerId: this._micProducer.id });\n\n      // store.dispatch(\n      //   producerActions.setProducerPaused(this._micProducer.id));\n\n      // store.dispatch(\n      //   settingsActions.setAudioMuted(true));\n\n    }\n    catch (error) {\n      this.logger.error('muteMic() [error:\"%o\"]', error);\n\n      // store.dispatch(requestActions.notify(\n      //   {\n      //     type: 'error',\n      //     text: intl.formatMessage({\n      //       id: 'devices.microphoneMuteError',\n      //       defaultMessage: 'Unable to mute your microphone'\n      //     })\n      //   }));\n    }\n  }\n\n  async unmuteMic() {\n    this.logger.debug('unmuteMic()');\n\n    if (!this._micProducer) {\n      this.updateMic({ start: true });\n    }\n    else {\n      this._micProducer.resume();\n\n      try {\n        await this.signalingService.sendRequest(\n          'resumeProducer', { producerId: this._micProducer.id });\n\n        // store.dispatch(\n        //   producerActions.setProducerResumed(this._micProducer.id));\n\n        // store.dispatch(\n        //   settingsActions.setAudioMuted(false));\n\n      }\n      catch (error) {\n        this.logger.error('unmuteMic() [error:\"%o\"]', error);\n\n        // store.dispatch(requestActions.notify(\n        //   {\n        //     type: 'error',\n        //     text: intl.formatMessage({\n        //       id: 'devices.microphoneUnMuteError',\n        //       defaultMessage: 'Unable to unmute your microphone'\n        //     })\n        //   }));\n      }\n    }\n  }\n\tdisconnectLocalHark()\n\t{\n\t\tthis.logger.debug('disconnectLocalHark()');\n\n\t\tif (this._harkStream != null)\n\t\t{\n\t\t\tlet [ track ] = this._harkStream.getAudioTracks();\n\n\t\t\ttrack.stop();\n\t\t\ttrack = null;\n\n\t\t\tthis._harkStream = null;\n\t\t}\n\n\t\tif (this._hark != null)\n\t\t\tthis._hark.stop();\n\t}\n\n\tconnectLocalHark(track)\n\t{\n\t\tthis.logger.debug('connectLocalHark() [track:\"%o\"]', track);\n\n\t\tthis._harkStream = new MediaStream();\n\n\t\tconst newTrack = track.clone();\n\n\t\tthis._harkStream.addTrack(newTrack);\n\n\t\tnewTrack.enabled = true;\n\n\t\tthis._hark = hark(this._harkStream,\n\t\t\t{\n\t\t\t\tplay      : false,\n\t\t\t\tinterval  : 10,\n\t\t\t\tthreshold : -50,\n\t\t\t\thistory   : 100\n\t\t\t});\n\n\t\tthis._hark.lastVolume = -100;\n\n\t\tthis._hark.on('volume_change', (volume) =>\n    {\n      // Update only if there is a bigger diff\n\t\t\tif (this._micProducer && Math.abs(volume - this._hark.lastVolume) > 0.5)\n\t\t\t{\n        // Decay calculation: keep in mind that volume range is -100 ... 0 (dB)\n\t\t\t\t// This makes decay volume fast if difference to last saved value is big\n\t\t\t\t// and slow for small changes. This prevents flickering volume indicator\n\t\t\t\t// at low levels\n\t\t\t\tif (volume < this._hark.lastVolume)\n\t\t\t\t{\n          volume =\n          this._hark.lastVolume -\n          Math.pow(\n            (volume - this._hark.lastVolume) /\n            (100 + this._hark.lastVolume)\n            , 2\n\t\t\t\t\t\t) * 10;\n          }\n\n          this._hark.lastVolume = volume;\n        // console.log('VOLUME CHANGE HARK');\n\n        // this.onVolumeChange.next({peer:this._peerId, volume})\n\t\t\t\t// store.dispatch(peerVolumeActions.setPeerVolume(this._peerId, volume));\n\t\t\t}\n\t\t});\n\n\t\t// this._hark.on('speaking', () =>\n\t\t// {\n\t\t// \tstore.dispatch(meActions.setIsSpeaking(true));\n\n\t\t// \tif (\n\t\t// \t\t(store.getState().settings.voiceActivatedUnmute ||\n\t\t// \t\tstore.getState().me.isAutoMuted) &&\n\t\t// \t\tthis._micProducer &&\n\t\t// \t\tthis._micProducer.paused\n\t\t// \t)\n\t\t// \t\tthis._micProducer.resume();\n\n\t\t// \tstore.dispatch(meActions.setAutoMuted(false)); // sanity action\n\t\t// });\n\n\t\t// this._hark.on('stopped_speaking', () =>\n\t\t// {\n\t\t// \tstore.dispatch(meActions.setIsSpeaking(false));\n\n\t\t// \tif (\n\t\t// \t\tstore.getState().settings.voiceActivatedUnmute &&\n\t\t// \t\tthis._micProducer &&\n\t\t// \t\t!this._micProducer.paused\n\t\t// \t)\n\t\t// \t{\n\t\t// \t\tthis._micProducer.pause();\n\n\t\t// \t\tstore.dispatch(meActions.setAutoMuted(true));\n\t\t// \t}\n\t\t// });\n\t}\n\n  async changeAudioOutputDevice(deviceId) {\n    this.logger.debug('changeAudioOutputDevice() [deviceId:\"%s\"]', deviceId);\n\n    // store.dispatch(\n    //   meActions.setAudioOutputInProgress(true));\n\n    try {\n      const device = this._audioOutputDevices[deviceId];\n\n      if (!device)\n        throw new Error('Selected audio output device no longer available');\n\n      // store.dispatch(settingsActions.setSelectedAudioOutputDevice(deviceId));\n\n      await this._updateAudioOutputDevices();\n    }\n    catch (error) {\n      this.logger.error('changeAudioOutputDevice() [error:\"%o\"]', error);\n    }\n\n    // store.dispatch(\n    //   meActions.setAudioOutputInProgress(false));\n  }\n\n  // Only Firefox supports applyConstraints to audio tracks\n  // See:\n  // https://bugs.chromium.org/p/chromium/issues/detail?id=796964\n  async updateMic({\n    start = false,\n    restart = false || this._device.flag !== 'firefox',\n    newDeviceId = null\n  } = {}) {\n    this.logger.debug(\n      'updateMic() [start:\"%s\", restart:\"%s\", newDeviceId:\"%s\"]',\n      start,\n      restart,\n      newDeviceId\n    );\n\n    let track;\n\n    try {\n      if (!this._mediasoupDevice.canProduce('audio'))\n        throw new Error('cannot produce audio');\n\n      if (newDeviceId && !restart)\n        throw new Error('changing device requires restart');\n\n      // if (newDeviceId)\n      //   store.dispatch(settingsActions.setSelectedAudioDevice(newDeviceId));\n\n      // store.dispatch(meActions.setAudioInProgress(true));\n\n      const deviceId = await this._getAudioDeviceId();\n      const device = this._audioDevices[deviceId];\n\n      if (!device)\n        throw new Error('no audio devices');\n\n      const autoGainControl = false;\n      const echoCancellation = true\n      const noiseSuppression = true\n\n      // if (!window.config.centralAudioOptions) {\n      //   throw new Error(\n      //     'Missing centralAudioOptions from app config! (See it in example config.)'\n      //   );\n      // }\n\n      const {\n        sampleRate = 96000,\n        channelCount = 1,\n        volume = 1.0,\n        sampleSize = 16,\n        opusStereo = false,\n        opusDtx = true,\n        opusFec = true,\n        opusPtime = 20,\n        opusMaxPlaybackRate = 96000\n      } = {};\n\n      if (\n        (restart && this._micProducer) ||\n        start\n      ) {\n        this.disconnectLocalHark();\n\n        if (this._micProducer)\n          await this.disableMic();\n\n        const stream = await navigator.mediaDevices.getUserMedia(\n          {\n            audio: {\n              deviceId: { ideal: deviceId },\n              sampleRate,\n              channelCount,\n              // @ts-ignore\n              volume,\n              autoGainControl,\n              echoCancellation,\n              noiseSuppression,\n              sampleSize\n            }\n          }\n        );\n\n        ([track] = stream.getAudioTracks());\n\n        const { deviceId: trackDeviceId } = track.getSettings();\n\n        // store.dispatch(settingsActions.setSelectedAudioDevice(trackDeviceId));\n\n        this._micProducer = await this._sendTransport.produce(\n          {\n            track,\n            codecOptions:\n            {\n              opusStereo,\n              opusDtx,\n              opusFec,\n              opusPtime,\n              opusMaxPlaybackRate\n            },\n            appData:\n              { source: 'mic' }\n          });\n\n        // store.dispatch(producerActions.addProducer(\n        //   {\n        //     id: this._micProducer.id,\n        //     source: 'mic',\n        //     paused: this._micProducer.paused,\n        //     track: this._micProducer.track,\n        //     rtpParameters: this._micProducer.rtpParameters,\n        //     codec: this._micProducer.rtpParameters.codecs[0].mimeType.split('/')[1]\n        //   }));\n\n        this._micProducer.on('transportclose', () => {\n          this._micProducer = null;\n        });\n\n        this._micProducer.on('trackended', () => {\n          // store.dispatch(requestActions.notify(\n          //   {\n          //     type: 'error',\n          //     text: intl.formatMessage({\n          //       id: 'devices.microphoneDisconnected',\n          //       defaultMessage: 'Microphone disconnected'\n          //     })\n          //   }));\n\n          this.disableMic();\n        });\n\n        this._micProducer.volume = 0;\n\n        this.connectLocalHark(track);\n      }\n      else if (this._micProducer) {\n        ({ track } = this._micProducer);\n\n        await track.applyConstraints(\n          {\n            sampleRate,\n            channelCount,\n            volume,\n            autoGainControl,\n            echoCancellation,\n            noiseSuppression,\n            sampleSize\n          }\n        );\n\n        if (this._harkStream != null) {\n          const [harkTrack] = this._harkStream.getAudioTracks();\n\n          harkTrack && await harkTrack.applyConstraints(\n            {\n              sampleRate,\n              channelCount,\n              volume,\n              autoGainControl,\n              echoCancellation,\n              noiseSuppression,\n              sampleSize\n            }\n          );\n        }\n      }\n\n      await this._updateAudioDevices();\n    }\n    catch (error) {\n      this.logger.error('updateMic() [error:\"%o\"]', error);\n\n      // store.dispatch(requestActions.notify(\n      //   {\n      //     type: 'error',\n      //     text: intl.formatMessage({\n      //       id: 'devices.microphoneError',\n      //       defaultMessage: 'An error occurred while accessing your microphone'\n      //     })\n      //   }));\n\n      if (track)\n        track.stop();\n    }\n\n    // store.dispatch(meActions.setAudioInProgress(false));\n  }\n\n  async updateWebcam({\n    init = false,\n    start = false,\n    restart = false,\n    newDeviceId = null,\n    newResolution = null,\n    newFrameRate = null\n  } = {}) {\n    this.logger.debug(\n      'updateWebcam() [start:\"%s\", restart:\"%s\", newDeviceId:\"%s\", newResolution:\"%s\", newFrameRate:\"%s\"]',\n      start,\n      restart,\n      newDeviceId,\n      newResolution,\n      newFrameRate\n    );\n\n    let track;\n\n    try {\n      if (!this._mediasoupDevice.canProduce('video'))\n        throw new Error('cannot produce video');\n\n      if (newDeviceId && !restart)\n        throw new Error('changing device requires restart');\n\n      // if (newDeviceId)\n      //   store.dispatch(settingsActions.setSelectedWebcamDevice(newDeviceId));\n\n      // if (newResolution)\n      //   store.dispatch(settingsActions.setVideoResolution(newResolution));\n\n      // if (newFrameRate)\n      //   store.dispatch(settingsActions.setVideoFrameRate(newFrameRate));\n\n      const  videoMuted  = false\n\n      if (init && videoMuted)\n        return;\n      // else\n        // store.dispatch(settingsActions.setVideoMuted(false));\n\n      // store.dispatch(meActions.setWebcamInProgress(true));\n\n      let deviceId\n      if (newDeviceId) {\n        deviceId = newDeviceId\n      }else{\n        deviceId = await this._getWebcamDeviceId();\n      }\n\n      const device = this._webcams[newDeviceId || deviceId];\n\n      console.log('WEBCAMS ', this._webcams, device, deviceId)\n      if (!device)\n        throw new Error('no webcam devices');\n\n      const  resolution = 'medium'\n      const frameRate = 15\n\n\n\n      if (\n        (restart && this._webcamProducer) ||\n        start\n      ) {\n        if (this._webcamProducer)\n          await this.disableWebcam();\n\n        const stream = await navigator.mediaDevices.getUserMedia(\n          {\n            video:\n            {\n              deviceId: { ideal: deviceId },\n              ...VIDEO_CONSTRAINS[resolution],\n              frameRate\n            }\n          });\n\n        ([track] = stream.getVideoTracks());\n\n        const { deviceId: trackDeviceId } = track.getSettings();\n\n        // store.dispatch(settingsActions.setSelectedWebcamDevice(trackDeviceId));\n\n        if (this._useSimulcast) {\n          // If VP9 is the only available video codec then use SVC.\n          const firstVideoCodec = this._mediasoupDevice\n            .rtpCapabilities\n            .codecs\n            .find((c) => c.kind === 'video');\n\n          let encodings;\n\n          if (firstVideoCodec.mimeType.toLowerCase() === 'video/vp9')\n            encodings = VIDEO_KSVC_ENCODINGS;\n          else if (simulcastEncodings)\n            encodings = simulcastEncodings;\n          else\n            encodings = VIDEO_SIMULCAST_ENCODINGS;\n\n          this._webcamProducer = await this._sendTransport.produce(\n            {\n              track,\n              encodings,\n              codecOptions:\n              {\n                videoGoogleStartBitrate: 1000\n              },\n              appData:\n              {\n                source: 'webcam'\n              }\n            });\n        }\n        else {\n          this._webcamProducer = await this._sendTransport.produce({\n            track,\n            appData:\n            {\n              source: 'webcam'\n            }\n          });\n        }\n\n        // store.dispatch(producerActions.addProducer(\n        //   {\n        //     id: this._webcamProducer.id,\n        //     source: 'webcam',\n        //     paused: this._webcamProducer.paused,\n        //     track: this._webcamProducer.track,\n        //     rtpParameters: this._webcamProducer.rtpParameters,\n        //     codec: this._webcamProducer.rtpParameters.codecs[0].mimeType.split('/')[1]\n        //   }));\n\n\n        const webCamStream = new Stream()\n        webCamStream.setProducer(this._webcamProducer);\n\n        this.onCamProducing.next(webCamStream)\n\n        this._webcamProducer.on('transportclose', () => {\n          this._webcamProducer = null;\n        });\n\n        this._webcamProducer.on('trackended', () => {\n          // store.dispatch(requestActions.notify(\n          //   {\n          //     type: 'error',\n          //     text: intl.formatMessage({\n          //       id: 'devices.cameraDisconnected',\n          //       defaultMessage: 'Camera disconnected'\n          //     })\n          //   }));\n\n          this.disableWebcam();\n        });\n      }\n      else if (this._webcamProducer) {\n        ({ track } = this._webcamProducer);\n\n        await track.applyConstraints(\n          {\n            ...VIDEO_CONSTRAINS[resolution],\n            frameRate\n          }\n        );\n\n        // Also change resolution of extra video producers\n        for (const producer of this._extraVideoProducers.values()) {\n          ({ track } = producer);\n\n          await track.applyConstraints(\n            {\n              ...VIDEO_CONSTRAINS[resolution],\n              frameRate\n            }\n          );\n        }\n      }\n\n      await this._updateWebcams();\n    }\n    catch (error) {\n      this.logger.error('updateWebcam() [error:\"%o\"]', error);\n\n      // store.dispatch(requestActions.notify(\n      //   {\n      //     type: 'error',\n      //     text: intl.formatMessage({\n      //       id: 'devices.cameraError',\n      //       defaultMessage: 'An error occurred while accessing your camera'\n      //     })\n      //   }));\n\n      if (track)\n        track.stop();\n    }\n\n    // store.dispatch(\n    //   meActions.setWebcamInProgress(false));\n  }\n\n  async closeMeeting() {\n    this.logger.debug('closeMeeting()');\n\n    // store.dispatch(\n    //   roomActions.setCloseMeetingInProgress(true));\n\n    try {\n      await this.signalingService.sendRequest('moderator:closeMeeting');\n    }\n    catch (error) {\n      this.logger.error('closeMeeting() [error:\"%o\"]', error);\n    }\n\n    // store.dispatch(\n    //   roomActions.setCloseMeetingInProgress(false));\n  }\n\n  // // type: mic/webcam/screen\n  // // mute: true/false\n  async modifyPeerConsumer(peerId, type, mute) {\n    this.logger.debug(\n      'modifyPeerConsumer() [peerId:\"%s\", type:\"%s\"]',\n      peerId,\n      type\n    );\n\n    // if (type === 'mic')\n    //   store.dispatch(\n    //     peerActions.setPeerAudioInProgress(peerId, true));\n    // else if (type === 'webcam')\n    //   store.dispatch(\n    //     peerActions.setPeerVideoInProgress(peerId, true));\n    // else if (type === 'screen')\n    //   store.dispatch(\n    //     peerActions.setPeerScreenInProgress(peerId, true));\n\n    try {\n      for (const consumer of this._consumers.values()) {\n        if (consumer.appData.peerId === peerId && consumer.appData.source === type) {\n          if (mute)\n            await this._pauseConsumer(consumer);\n          else\n            await this._resumeConsumer(consumer);\n        }\n      }\n    }\n    catch (error) {\n      this.logger.error('modifyPeerConsumer() [error:\"%o\"]', error);\n    }\n\n    // if (type === 'mic')\n    //   store.dispatch(\n    //     peerActions.setPeerAudioInProgress(peerId, false));\n    // else if (type === 'webcam')\n    //   store.dispatch(\n    //     peerActions.setPeerVideoInProgress(peerId, false));\n    // else if (type === 'screen')\n    //   store.dispatch(\n    //     peerActions.setPeerScreenInProgress(peerId, false));\n  }\n\n  async _pauseConsumer(consumer) {\n    this.logger.debug('_pauseConsumer() [consumer:\"%o\"]', consumer);\n\n    if (consumer.paused || consumer.closed)\n      return;\n\n    try {\n      await this.signalingService.sendRequest('pauseConsumer', { consumerId: consumer.id });\n\n      consumer.pause();\n\n      // store.dispatch(\n      //   consumerActions.setConsumerPaused(consumer.id, 'local'));\n    }\n    catch (error) {\n      this.logger.error('_pauseConsumer() [error:\"%o\"]', error);\n    }\n  }\n\n  async _resumeConsumer(consumer) {\n    this.logger.debug('_resumeConsumer() [consumer:\"%o\"]', consumer);\n\n    if (!consumer.paused || consumer.closed)\n      return;\n\n    try {\n      await this.signalingService.sendRequest('resumeConsumer', { consumerId: consumer.id });\n\n      consumer.resume();\n\n      // store.dispatch(\n      //   consumerActions.setConsumerResumed(consumer.id, 'local'));\n    }\n    catch (error) {\n      this.logger.error('_resumeConsumer() [error:\"%o\"]', error);\n    }\n  }\n\n  // async setMaxSendingSpatialLayer(spatialLayer) {\n  //   logger.debug('setMaxSendingSpatialLayer() [spatialLayer:\"%s\"]', spatialLayer);\n\n  //   try {\n  //     if (this._webcamProducer)\n  //       await this._webcamProducer.setMaxSpatialLayer(spatialLayer);\n  //     if (this._screenSharingProducer)\n  //       await this._screenSharingProducer.setMaxSpatialLayer(spatialLayer);\n  //   }\n  //   catch (error) {\n  //     logger.error('setMaxSendingSpatialLayer() [error:\"%o\"]', error);\n  //   }\n  // }\n\n  // async setConsumerPreferredLayers(consumerId, spatialLayer, temporalLayer) {\n  //   logger.debug(\n  //     'setConsumerPreferredLayers() [consumerId:\"%s\", spatialLayer:\"%s\", temporalLayer:\"%s\"]',\n  //     consumerId, spatialLayer, temporalLayer);\n\n  //   try {\n  //     await this.sendRequest(\n  //       'setConsumerPreferedLayers', { consumerId, spatialLayer, temporalLayer });\n\n  //     store.dispatch(consumerActions.setConsumerPreferredLayers(\n  //       consumerId, spatialLayer, temporalLayer));\n  //   }\n  //   catch (error) {\n  //     logger.error('setConsumerPreferredLayers() [error:\"%o\"]', error);\n  //   }\n  // }\n\n  // async setConsumerPriority(consumerId, priority) {\n  //   logger.debug(\n  //     'setConsumerPriority() [consumerId:\"%s\", priority:%d]',\n  //     consumerId, priority);\n\n  //   try {\n  //     await this.sendRequest('setConsumerPriority', { consumerId, priority });\n\n  //     store.dispatch(consumerActions.setConsumerPriority(consumerId, priority));\n  //   }\n  //   catch (error) {\n  //     logger.error('setConsumerPriority() [error:\"%o\"]', error);\n  //   }\n  // }\n\n  // async requestConsumerKeyFrame(consumerId) {\n  //   logger.debug('requestConsumerKeyFrame() [consumerId:\"%s\"]', consumerId);\n\n  //   try {\n  //     await this.sendRequest('requestConsumerKeyFrame', { consumerId });\n  //   }\n  //   catch (error) {\n  //     logger.error('requestConsumerKeyFrame() [error:\"%o\"]', error);\n  //   }\n  // }\n\n\n\n\n  async join({ roomId, joinVideo, joinAudio, token }) {\n\n\n    this._roomId = roomId;\n\n\n    // initialize signaling socket\n    // listen to socket events\n    this.signalingService.init(token)\n   this.subscriptions.push(this.signalingService.onDisconnected.subscribe( () => {\n      // close\n      // this.close\n    }))\n    this.subscriptions.push(this.signalingService.onReconnecting.subscribe( () => {\n      // close\n\n      this.logger.log('Reconnecting...')\n\n\n\t\t\tif (this._webcamProducer)\n\t\t\t{\n\t\t\t\tthis._webcamProducer.close();\n\n\t\t\t\t// store.dispatch(\n\t\t\t\t// \tproducerActions.removeProducer(this._webcamProducer.id));\n\n\t\t\t\tthis._webcamProducer = null;\n\t\t\t}\n\n\t\t\tif (this._micProducer)\n\t\t\t{\n\t\t\t\tthis._micProducer.close();\n\n\t\t\t\t// store.dispatch(\n\t\t\t\t// \tproducerActions.removeProducer(this._micProducer.id));\n\n\t\t\t\tthis._micProducer = null;\n\t\t\t}\n\n\t\t\tif (this._sendTransport)\n\t\t\t{\n\t\t\t\tthis._sendTransport.close();\n\n\t\t\t\tthis._sendTransport = null;\n\t\t\t}\n\n\t\t\tif (this._recvTransport)\n\t\t\t{\n\t\t\t\tthis._recvTransport.close();\n\n\t\t\t\tthis._recvTransport = null;\n\t\t\t}\n\n      this.remotePeersService.clearPeers();\n\n\n\t\t\t// store.dispatch(roomActions.setRoomState('connecting'));\n    }))\n\n    this.subscriptions.push(this.signalingService.onNewConsumer.pipe(switchMap(async (data) => {\n      const {\n        peerId,\n        producerId,\n        id,\n        kind,\n        rtpParameters,\n        type,\n        appData,\n        producerPaused\n      } = data;\n\n      const consumer  = await this._recvTransport.consume(\n        {\n          id,\n          producerId,\n          kind,\n          rtpParameters,\n          appData : { ...appData, peerId } // Trick.\n        }) as mediasoupClient.types.Consumer;\n\n      // Store in the map.\n      this._consumers.set(consumer.id, consumer);\n\n      consumer.on('transportclose', () =>\n      {\n        this._consumers.delete(consumer.id);\n      });\n\n\n\n\n      this.remotePeersService.newConsumer(consumer,  peerId, type, producerPaused);\n\n      // We are ready. Answer the request so the server will\n      // resume this Consumer (which was paused for now).\n\n\n      // if (kind === 'audio')\n      // {\n      //   consumer.volume = 0;\n\n      //   const stream = new MediaStream();\n\n      //   stream.addTrack(consumer.track);\n\n      //   if (!stream.getAudioTracks()[0])\n      //     throw new Error('request.newConsumer | given stream has no audio track');\n\n        // consumer.hark = hark(stream, { play: false });\n\n        // consumer.hark.on('volume_change', (volume) =>\n        // {\n        //   volume = Math.round(volume);\n\n        //   if (consumer && volume !== consumer.volume)\n        //   {\n        //     consumer.volume = volume;\n\n        //     // store.dispatch(peerVolumeActions.setPeerVolume(peerId, volume));\n        //   }\n        // });\n      // }\n\n    })).subscribe())\n\n    this.subscriptions.push(this.signalingService.onNotification.pipe(switchMap(async (notification) => {\n      this.logger.debug(\n        'socket \"notification\" event [method:\"%s\", data:\"%o\"]',\n        notification.method, notification.data);\n\n      try {\n        switch (notification.method) {\n\n\n\n          case 'producerScore':\n            {\n              const { producerId, score } = notification.data;\n\n              // store.dispatch(\n              //   producerActions.setProducerScore(producerId, score));\n\n              break;\n            }\n\n          case 'newPeer':\n            {\n              const { id, displayName, picture, roles } = notification.data;\n\n              // store.dispatch(peerActions.addPeer(\n              //   { id, displayName, picture, roles, consumers: [] }));\n\n              this.remotePeersService.newPeer(id);\n\n              // this._soundNotification();\n\n              // store.dispatch(requestActions.notify(\n              //   {\n              //     text: intl.formatMessage({\n              //       id: 'room.newPeer',\n              //       defaultMessage: '{displayName} joined the room'\n              //     }, {\n              //       displayName\n              //     })\n              //   }));\n\n              break;\n            }\n\n          case 'peerClosed':\n            {\n              const { peerId } = notification.data;\n\n              this.remotePeersService.closePeer(peerId);\n\n              // store.dispatch(\n              //   peerActions.removePeer(peerId));\n\n              break;\n            }\n\n          case 'consumerClosed':\n            {\n              const { consumerId } = notification.data;\n              const consumer = this._consumers.get(consumerId);\n\n              if (!consumer)\n                break;\n\n              consumer.close();\n\n              if (consumer.hark != null)\n                consumer.hark.stop();\n\n              this._consumers.delete(consumerId);\n\n              const { peerId } = consumer.appData;\n\n              // store.dispatch(\n              //   consumerActions.removeConsumer(consumerId, peerId));\n\n              break;\n            }\n\n          case 'consumerPaused':\n            {\n              const { consumerId } = notification.data;\n              const consumer = this._consumers.get(consumerId);\n\n              if (!consumer)\n                break;\n\n              // store.dispatch(\n              //   consumerActions.setConsumerPaused(consumerId, 'remote'));\n\n              break;\n            }\n\n          case 'consumerResumed':\n            {\n              const { consumerId } = notification.data;\n              const consumer = this._consumers.get(consumerId);\n\n              if (!consumer)\n                break;\n\n              // store.dispatch(\n              //   consumerActions.setConsumerResumed(consumerId, 'remote'));\n\n              break;\n            }\n\n          case 'consumerLayersChanged':\n            {\n              const { consumerId, spatialLayer, temporalLayer } = notification.data;\n              const consumer = this._consumers.get(consumerId);\n\n              if (!consumer)\n                break;\n\n              this.remotePeersService.onConsumerLayerChanged(consumerId)\n              // store.dispatch(consumerActions.setConsumerCurrentLayers(\n              //   consumerId, spatialLayer, temporalLayer));\n\n              break;\n            }\n\n          case 'consumerScore':\n            {\n              const { consumerId, score } = notification.data;\n\n              // store.dispatch(\n              //   consumerActions.setConsumerScore(consumerId, score));\n\n              break;\n            }\n            case 'roomBack':\n              {\n                await this._joinRoom({ joinVideo, joinAudio });\n\n                break;\n              }\n\n              case 'roomReady':\n                {\n                  const { turnServers } = notification.data;\n\n                  this._turnServers = turnServers;\n\n                  // store.dispatch(roomActions.toggleJoined());\n                  // store.dispatch(roomActions.setInLobby(false));\n\n                  await this._joinRoom({ joinVideo, joinAudio });\n\n                  break;\n            }\n            case 'activeSpeaker':\n              {\n                const { peerId } = notification.data;\n\n\n\n              if (peerId === this._peerId) {\n                  this.onVolumeChange.next(notification.data)\n                }\n                  // this._spotlights.handleActiveSpeaker(peerId);\n\n                break;\n              }\n          default:\n            {\n              // this.logger.error(\n              //   'unknown notification.method \"%s\"', notification.method);\n            }\n        }\n      }\n      catch (error) {\n        this.logger.error('error on socket \"notification\" event [error:\"%o\"]', error);\n\n        // store.dispatch(requestActions.notify(\n        //   {\n        //     type: 'error',\n        //     text: intl.formatMessage({\n        //       id: 'socket.requestError',\n        //       defaultMessage: 'Error on server request'\n        //     })\n        //   }));\n      }\n\n    })).subscribe())\n    // on room ready join room _joinRoom\n\n    // this._mediasoupDevice = new mediasoupClient.Device();\n\n    // const routerRtpCapabilities =\n    //   await this.sendRequest('getRouterRtpCapabilities');\n\n    // routerRtpCapabilities.headerExtensions = routerRtpCapabilities.headerExtensions\n    //   .filter((ext) => ext.uri !== 'urn:3gpp:video-orientation');\n\n    // await this._mediasoupDevice.load({ routerRtpCapabilities });\n\n    // create send transport createWebRtcTransport this.signalingService.sendCreateTransport\n    // listen to transport events\n\n    // create receive transport this.signalingService.sendCreateTranspor\n    // listen to transport events\n\n    // send join request\n\n    // add peers to peers service\n\n    // produce updateWebcam updateMic\n  }\n\n\n\tasync _updateAudioDevices()\n\t{\n\t\tthis.logger.debug('_updateAudioDevices()');\n\n\t\t// Reset the list.\n\t\tthis._audioDevices = {};\n\n\t\ttry\n\t\t{\n\t\t\tthis.logger.debug('_updateAudioDevices() | calling enumerateDevices()');\n\n\t\t\tconst devices = await navigator.mediaDevices.enumerateDevices();\n\n\t\t\tfor (const device of devices)\n\t\t\t{\n\t\t\t\tif (device.kind !== 'audioinput')\n\t\t\t\t\tcontinue;\n\n\t\t\t\tthis._audioDevices[device.deviceId] = device;\n\t\t\t}\n\n\t\t\t// store.dispatch(\n\t\t\t// \tmeActions.setAudioDevices(this._audioDevices));\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tthis.logger.error('_updateAudioDevices() [error:\"%o\"]', error);\n\t\t}\n\t}\n\n\tasync _updateWebcams()\n\t{\n\t\tthis.logger.debug('_updateWebcams()');\n\n\t\t// Reset the list.\n\t\tthis._webcams = {};\n\n\t\ttry\n\t\t{\n\t\t\tthis.logger.debug('_updateWebcams() | calling enumerateDevices()');\n\n\t\t\tconst devices = await navigator.mediaDevices.enumerateDevices();\n\n\t\t\tfor (const device of devices)\n\t\t\t{\n\t\t\t\tif (device.kind !== 'videoinput')\n\t\t\t\t\tcontinue;\n\n\t\t\t\tthis._webcams[device.deviceId] = device;\n\t\t\t}\n\n\t\t\t// store.dispatch(\n\t\t\t// \tmeActions.setWebcamDevices(this._webcams));\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tthis.logger.error('_updateWebcams() [error:\"%o\"]', error);\n\t\t}\n\t}\n\n\tasync disableWebcam()\n\t{\n\t\tthis.logger.debug('disableWebcam()');\n\n\t\tif (!this._webcamProducer)\n\t\t\treturn;\n\n\t\t// store.dispatch(meActions.setWebcamInProgress(true));\n\n\t\tthis._webcamProducer.close();\n\n\t\t// store.dispatch(\n\t\t// \tproducerActions.removeProducer(this._webcamProducer.id));\n\n\t\ttry\n\t\t{\n\t\t\tawait this.signalingService.sendRequest(\n\t\t\t\t'closeProducer', { producerId: this._webcamProducer.id });\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tthis.logger.error('disableWebcam() [error:\"%o\"]', error);\n\t\t}\n\n\t\tthis._webcamProducer = null;\n\t\t// store.dispatch(settingsActions.setVideoMuted(true));\n\t\t// store.dispatch(meActions.setWebcamInProgress(false));\n\t}\n\tasync disableMic()\n\t{\n\t\tthis.logger.debug('disableMic()');\n\n\t\tif (!this._micProducer)\n\t\t\treturn;\n\n\t\t// store.dispatch(meActions.setAudioInProgress(true));\n\n\t\tthis._micProducer.close();\n\n\t\t// store.dispatch(\n\t\t// \tproducerActions.removeProducer(this._micProducer.id));\n\n\t\ttry\n\t\t{\n\t\t\tawait this.signalingService.sendRequest(\n\t\t\t\t'closeProducer', { producerId: this._micProducer.id });\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tthis.logger.error('disableMic() [error:\"%o\"]', error);\n\t\t}\n\n\t\tthis._micProducer = null;\n\n\t\t// store.dispatch(meActions.setAudioInProgress(false));\n  }\n\n\n\tasync _getWebcamDeviceId()\n\t{\n\t\tthis.logger.debug('_getWebcamDeviceId()');\n\n\t\ttry\n\t\t{\n\t\t\tthis.logger.debug('_getWebcamDeviceId() | calling _updateWebcams()');\n\n\t\t\tawait this._updateWebcams();\n\n\t\t\tconst  selectedWebcam =  null\n\n\t\t\tif (selectedWebcam && this._webcams[selectedWebcam])\n\t\t\t\treturn selectedWebcam;\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst webcams = Object.values(this._webcams);\n\n        // @ts-ignore\n\t\t\t\treturn webcams[0] ? webcams[0].deviceId : null;\n\t\t\t}\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tthis.logger.error('_getWebcamDeviceId() [error:\"%o\"]', error);\n\t\t}\n  }\n\n\n\tasync _getAudioDeviceId()\n\t{\n\t\tthis.logger.debug('_getAudioDeviceId()');\n\n\t\ttry\n\t\t{\n\t\t\tthis.logger.debug('_getAudioDeviceId() | calling _updateAudioDeviceId()');\n\n\t\t\tawait this._updateAudioDevices();\n\n      const  selectedAudioDevice = null;\n\n\t\t\tif (selectedAudioDevice && this._audioDevices[selectedAudioDevice])\n\t\t\t\treturn selectedAudioDevice;\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst audioDevices = Object.values(this._audioDevices);\n\n        // @ts-ignore\n\t\t\t\treturn audioDevices[0] ? audioDevices[0].deviceId : null;\n\t\t\t}\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tthis.logger.error('_getAudioDeviceId() [error:\"%o\"]', error);\n\t\t}\n\t}\n\n\tasync _updateAudioOutputDevices()\n\t{\n\t\tthis.logger.debug('_updateAudioOutputDevices()');\n\n\t\t// Reset the list.\n\t\tthis._audioOutputDevices = {};\n\n\t\ttry\n\t\t{\n\t\t\tthis.logger.debug('_updateAudioOutputDevices() | calling enumerateDevices()');\n\n\t\t\tconst devices = await navigator.mediaDevices.enumerateDevices();\n\n\t\t\tfor (const device of devices)\n\t\t\t{\n\t\t\t\tif (device.kind !== 'audiooutput')\n\t\t\t\t\tcontinue;\n\n\t\t\t\tthis._audioOutputDevices[device.deviceId] = device;\n\t\t\t}\n\n\t\t\t// store.dispatch(\n\t\t\t// \tmeActions.setAudioOutputDevices(this._audioOutputDevices));\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tthis.logger.error('_updateAudioOutputDevices() [error:\"%o\"]', error);\n\t\t}\n\t}\n\n\n\n  async _joinRoom({ joinVideo, joinAudio }) {\n    this.logger.debug('_joinRoom() Device', this._device);\n\n    const displayName = `Guest ${Math.floor(Math.random() * (100000 - 10000)) + 10000}`\n\n\n    try {\n\n\n      if (this._device.os === 'ios') {\n        this._mediasoupDevice = new mediasoupClient.Device({handlerName:'Safari12'});\n      } else {\n        this._mediasoupDevice = new mediasoupClient.Device();\n      }\n\n      const routerRtpCapabilities =\n        await this.signalingService.sendRequest('getRouterRtpCapabilities');\n\n      routerRtpCapabilities.headerExtensions = routerRtpCapabilities.headerExtensions\n        .filter((ext) => ext.uri !== 'urn:3gpp:video-orientation');\n\n      await this._mediasoupDevice.load({ routerRtpCapabilities });\n\n      if (this._produce) {\n        const transportInfo = await this.signalingService.sendRequest(\n          'createWebRtcTransport',\n          {\n            forceTcp: this._forceTcp,\n            producing: true,\n            consuming: false\n          });\n\n        const {\n          id,\n          iceParameters,\n          iceCandidates,\n          dtlsParameters\n        } = transportInfo;\n\n        this._sendTransport = this._mediasoupDevice.createSendTransport(\n          {\n            id,\n            iceParameters,\n            iceCandidates,\n            dtlsParameters,\n            iceServers: this._turnServers,\n            // TODO: Fix for issue #72\n            iceTransportPolicy: this._device.flag === 'firefox' && this._turnServers ? 'relay' : undefined,\n            proprietaryConstraints: PC_PROPRIETARY_CONSTRAINTS\n          });\n\n        this._sendTransport.on(\n          'connect', ({ dtlsParameters }, callback, errback) => // eslint-disable-line no-shadow\n        {\n          this.signalingService.sendRequest(\n            'connectWebRtcTransport',\n            {\n              transportId: this._sendTransport.id,\n              dtlsParameters\n            })\n            .then(callback)\n            .catch(errback);\n        });\n\n        this._sendTransport.on(\n          'produce', async ({ kind, rtpParameters, appData }, callback, errback) => {\n          try {\n            // eslint-disable-next-line no-shadow\n            const { id } = await this.signalingService.sendRequest(\n              'produce',\n              {\n                transportId: this._sendTransport.id,\n                kind,\n                rtpParameters,\n                appData\n              });\n\n            callback({ id });\n          }\n          catch (error) {\n            errback(error);\n          }\n        });\n      }\n\n      const transportInfo = await this.signalingService.sendRequest(\n        'createWebRtcTransport',\n        {\n          forceTcp: this._forceTcp,\n          producing: false,\n          consuming: true\n        });\n\n      const {\n        id,\n        iceParameters,\n        iceCandidates,\n        dtlsParameters\n      } = transportInfo;\n\n      this._recvTransport = this._mediasoupDevice.createRecvTransport(\n        {\n          id,\n          iceParameters,\n          iceCandidates,\n          dtlsParameters,\n          iceServers: this._turnServers,\n          // TODO: Fix for issue #72\n          iceTransportPolicy: this._device.flag === 'firefox' && this._turnServers ? 'relay' : undefined\n        });\n\n      this._recvTransport.on(\n        'connect', ({ dtlsParameters }, callback, errback) => // eslint-disable-line no-shadow\n      {\n        this.signalingService.sendRequest(\n          'connectWebRtcTransport',\n          {\n            transportId: this._recvTransport.id,\n            dtlsParameters\n          })\n          .then(callback)\n          .catch(errback);\n      });\n\n      // Set our media capabilities.\n      // store.dispatch(meActions.setMediaCapabilities(\n      // \t{\n      // \t\tcanSendMic     : this._mediasoupDevice.canProduce('audio'),\n      // \t\tcanSendWebcam  : this._mediasoupDevice.canProduce('video'),\n      // \t\tcanShareScreen : this._mediasoupDevice.canProduce('video') &&\n      // \t\t\tthis._screenSharing.isScreenShareAvailable(),\n      // \t\tcanShareFiles : this._torrentSupport\n      // \t}));\n\n      const {\n        authenticated,\n        roles,\n        peers,\n        tracker,\n        roomPermissions,\n        userRoles,\n        allowWhenRoleMissing,\n        chatHistory,\n        fileHistory,\n        lastNHistory,\n        locked,\n        lobbyPeers,\n        accessCode\n      } = await this.signalingService.sendRequest(\n        'join',\n        {\n          displayName: displayName,\n\n          rtpCapabilities: this._mediasoupDevice.rtpCapabilities\n        });\n\n      this.logger.debug(\n        '_joinRoom() joined [authenticated:\"%s\", peers:\"%o\", roles:\"%o\", userRoles:\"%o\"]',\n        authenticated,\n        peers,\n        roles,\n        userRoles\n      );\n\n\n\n\n\n      // for (const peer of peers)\n      // {\n      // \tstore.dispatch(\n      // \t\tpeerActions.addPeer({ ...peer, consumers: [] }));\n      // }\n\n        this.logger.debug('join audio',joinAudio , 'can produce audio',\n          this._mediasoupDevice.canProduce('audio'), ' this._muted', this._muted)\n      // Don't produce if explicitly requested to not to do it.\n      if (this._produce) {\n        if (\n          joinVideo\n        ) {\n          this.updateWebcam({ init: true, start: true });\n        }\n        if (\n          joinAudio &&\n          this._mediasoupDevice.canProduce('audio')\n        )\n          if (!this._muted) {\n            await this.updateMic({ start: true });\n\n          }\n      }\n\n      await this._updateAudioOutputDevices();\n\n      // const  selectedAudioOutputDevice  = null\n\n      // if (!selectedAudioOutputDevice && this._audioOutputDevices !== {})\n      // {\n      // \tstore.dispatch(\n      // \t\tsettingsActions.setSelectedAudioOutputDevice(\n      // \t\t\tObject.keys(this._audioOutputDevices)[0]\n      // \t\t)\n      // \t);\n      // }\n\n      // store.dispatch(roomActions.setRoomState('connected'));\n\n      // // Clean all the existing notifications.\n      // store.dispatch(notificationActions.removeAllNotifications());\n\n      // store.dispatch(requestActions.notify(\n      // \t{\n      // \t\ttext : intl.formatMessage({\n      // \t\t\tid             : 'room.joined',\n      // \t\t\tdefaultMessage : 'You have joined the room'\n      // \t\t})\n      // \t}));\n\n      this.remotePeersService.addPeers(peers);\n\n\n    }\n    catch (error) {\n      this.logger.error('_joinRoom() [error:\"%o\"]', error);\n\n\n      this.close();\n    }\n  }\n  deviceInfo() {\n    const ua = navigator.userAgent;\n    const browser = bowser.getParser(ua);\n\n    let flag;\n\n    if (browser.satisfies({ chrome: '>=0', chromium: '>=0' }))\n      flag = 'chrome';\n    else if (browser.satisfies({ firefox: '>=0' }))\n      flag = 'firefox';\n    else if (browser.satisfies({ safari: '>=0' }))\n      flag = 'safari';\n    else if (browser.satisfies({ opera: '>=0' }))\n      flag = 'opera';\n    else if (browser.satisfies({ 'microsoft edge': '>=0' }))\n      flag = 'edge';\n    else\n      flag = 'unknown';\n\n    return {\n      flag,\n      os: browser.getOSName(true), // ios, android, linux...\n      platform: browser.getPlatformType(true), // mobile, desktop, tablet\n      name: browser.getBrowserName(true),\n      version: browser.getBrowserVersion(),\n      bowser: browser\n    };\n  }\n}\n","/*\n * Public API Surface of hug-angular-lib\n */\n\nexport * from './lib/hug-angular-lib.component';\nexport * from './lib/hug-angular-lib.module';\nexport * from './lib/room.service'\nexport * from './lib/log.service'\nexport * from './lib/remote-peers.service';\nexport {LogService} from './lib/log.service'\n\nexport * from './lib/stream'\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":["i0.elementStart","i0.text","i0.elementEnd","LogService","mediasoupClient.Device"],"mappings":"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"}